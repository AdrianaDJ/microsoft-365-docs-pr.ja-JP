---
title: コネクタをセットアップして人事データをインポートする
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: ''
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection: M365-security-compliance
description: 管理者は、組織の人事 (HR) システムから Microsoft 365 に従業員データをインポートするためのデータコネクタをセットアップすることができます。 これにより、社内リスク管理ポリシーの人事データを使用して、組織に内部の脅威をもたらす可能性がある特定のユーザーによるアクティビティを検出することができます。
ms.openlocfilehash: beebb4a6fba9baf2770bee7e3bd7a7b5a0fed0b1
ms.sourcegitcommit: 3c39866865c8c61bce2169818d8551da65033cfe
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/30/2020
ms.locfileid: "48816670"
---
# <a name="set-up-a-connector-to-import-hr-data"></a>コネクタをセットアップして人事データをインポートする

Microsoft 365 コンプライアンスセンターでデータコネクタをセットアップして、ユーザーの resignation、ユーザーの職務レベルでの変更などのイベントに関連する人事 (HR) データをインポートすることができます。 その後、人事データを [insider リスク管理ソリューション](insider-risk-management.md) で使用して、組織内のユーザーによる悪意のあるアクティビティやデータの盗難を識別するのに役立つリスク指標を生成できます。

内部リスク管理ポリシーがリスク指標の生成に使用できる人事データ用のコネクタを設定するには、人事データを含む CSV ファイルを作成します。認証に使用される Azure Active Directory でアプリを作成し、Microsoft 365 コンプライアンスセンターで人事データコネクタを作成し、(スケジュールに従って) ingests を実行して、CSV ファイルの人事データを Microsoft クラウドに公開し、内部者が使用できるようにするスクリプトを実行します。リスク管理ソリューション。

## <a name="before-you-begin"></a>はじめに

- Microsoft 365 にインポートする人事シナリオとデータを決定します。 これは、作成する必要がある CSV ファイルおよび人事コネクタの数と、CSV ファイルを生成して構造化する方法を決定するのに役立ちます。 インポートする人事データは、実装する insider リスク管理ポリシーによって決定されます。 詳細については、「Step 1」を参照してください。

- 組織の HR システム (および定期的に) からデータを取得またはエクスポートし、手順1で作成した CSV ファイルに追加する方法を決定します。 手順4で実行したスクリプトは、CSV ファイル内の人事データを Microsoft クラウドにアップロードします。

- 組織は、Office 365 インポートサービスが組織内のデータにアクセスできるようにするための同意を得る必要があります。 この要求に同意するには、 [このページ](https://login.microsoftonline.com/common/oauth2/authorize?client_id=570d0bec-d001-4c4e-985e-3ab17fdc3073&response_type=code&redirect_uri=https://portal.azure.com/&nonce=1234&prompt=admin_consent)に移動して、Microsoft 365 グローバル管理者の資格情報でサインインし、要求を承諾します。 手順3で HR コネクタを正常に作成するには、この手順を完了する必要があります。

- 手順3で HR コネクタを作成したユーザーに、Exchange Online のメールボックスのインポートのエクスポート役割が割り当てられている必要があります。 既定では、この役割は Exchange Online のどの役割グループにも割り当てられていません。 Exchange Online の組織の管理役割グループに、メールボックスのインポートの役割を追加することができます。 または、新しい役割グループを作成し、メールボックスインポートエクスポートの役割を割り当ててから、適切なユーザーをメンバーとして追加することもできます。 詳細については、記事「Manage role groups in Exchange Online」の「 [役割グループの作成](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#create-role-groups) 」または「 [役割グループの変更](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#modify-role-groups) 」のセクションを参照してください。

- 手順4で実行したサンプルスクリプトは、人事データを insider リスク管理ソリューションで使用できるように Microsoft クラウドにアップロードします。 このサンプルスクリプトは、Microsoft の標準サポートプログラムまたはサービスではサポートされていません。 このサンプルスクリプトは、あらゆる種類の保証なしに提供されています。 さらに、Microsoft は、商品性、特定目的への適合性を含む一切の黙示の保証をいたしかねます。 サンプルスクリプトおよびドキュメントの使用によって発生した、またはパフォーマンスの低下によって生じるリスク全体は、そのままになります。 サンプル スクリプトおよびドキュメントを使用したこと、または使用できなかったことに伴って生じるいかなる損害 (業務利益の損失、業務の中断、業務情報の損失、金銭上の損失、その他一切の損害) についても、Microsoft、Microsoft に帰属する作者、スクリプトの作成、製造、または納入に関与したその他のすべての人員は、いかなる場合も責めを負わないものとします。

## <a name="step-1-prepare-a-csv-file-with-your-hr-data"></a>手順 1: 人事データを含む CSV ファイルを準備する

最初の手順として、connector が Microsoft 365 にインポートする人事データを含む CSV ファイルを作成します。 このデータは、潜在的なリスク指標を生成するために insider リスクソリューションによって使用されます。 次の人事シナリオのデータを Microsoft 365 にインポートできます。

- Employee resignation 組織を離れているユーザーに関する情報。

- ジョブレベルの変更。 昇格や降格など、ユーザーのジョブレベルの変更に関する情報。

- 業績評価。 ユーザーパフォーマンスに関する情報。

- パフォーマンス向上計画。 ユーザーのパフォーマンス向上計画についての情報。

インポートする人事データの種類は、実装する必要がある内部のリスク管理ポリシーと対応するポリシーテンプレートによって異なります。 次の表に、各ポリシーテンプレートに必要な HR データ型を示します。

|  ポリシー テンプレート |  人事データの種類 |
|:-----------------------------------------------|:---------------------------------------------------------------------|
| ユーザーが出発したデータの盗難                   | Employee resignations                                                 |
| 一般的なデータリーク                              | 該当なし                                                        |
| 優先度の高いユーザーによるデータリーク                    | 該当なし                                                        |
| 不満のあるユーザーによるデータリーク                 | 業務レベルの変更、業績評価、パフォーマンス改善計画 |
| 一般的なセキュリティポリシー違反              | 該当なし                                                        |
| ユーザーを出発することによるセキュリティポリシー違反   | Employee resignations                                                 |
| 優先度が高いユーザーによるセキュリティポリシー違反    | 該当なし                                                        |
| 不満のあるユーザーによるセキュリティポリシー違反 | 業務レベルの変更、業績評価、パフォーマンス改善計画 |
| メールの不快な言葉                     | 該当なし                                                        |

Insider リスク管理のポリシーテンプレートの詳細については、「 [insider リスク管理ポリシー](insider-risk-management-policies.md#policy-templates)」を参照してください。

人事シナリオごとに、1つ以上の CSV ファイルに対応する人事データを提供する必要があります。 Insider のリスク管理の実装に使用する CSV ファイルの数については、このセクションで後述します。

必要な人事データを使用して CSV ファイルを作成したら、手順4で、スクリプトを実行するローカルコンピューターに保存します。 また、スクリプトを実行するたびに最新の情報が CSV ファイルに常に含まれるように、更新戦略を実装する必要があります。最新の HR データが Microsoft cloud にアップロードされ、insider リスク管理ソリューションからアクセスできるようになります。

> [!IMPORTANT]
> 以下のセクションで説明する列の名前は必須パラメーターではありませんが、例にすぎません。 CSV ファイルでは、任意の列名を使用できます。 ただし、手順3で HR コネクタを作成する場合は、CSV ファイルで使用する列名をデータ型にマップする *必要があり* ます。 また、以下のセクションにあるサンプルの CSV ファイルは、メモ帳のビューに表示されることにも注意してください。 Microsoft Excel では、CSV ファイルの表示と編集がより簡単になりました。

次のセクションでは、人事シナリオごとに必要な CSV データについて説明します。

### <a name="csv-file-for-employee-resignation-data"></a>従業員 resignation データ用の CSV ファイル

Employee resignation データの CSV ファイルの例を次に示します。

```text
EmailAddress,ResignationDate,LastWorkingDate
sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,2019-04-29T15:18:02.4675041+05:30
pilarp@contoso.com,2019-04-24T09:15:49Z,2019-04-29T15:18:02.7117540
```

次の表では、従業員 resignation データの CSV ファイルの各列について説明します。

|  列   |   説明 |
|:------------|:----------------|
|**EmailAddress**| 終了したユーザーの電子メールアドレス (UPN) を指定します。|
| **ResignationDate** | ユーザーの雇用が組織内で正式に終了した日付を指定します。 たとえば、ユーザーが組織を離れたことについての通知を受け取った日付が表示されることがあります。 この日付は、ユーザーの最終作業日の日付と異なる場合があります。 `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` [ISO 8601 の日付と時刻の形式](https://www.iso.org/iso-8601-date-and-time-format.html)を使用して、次の日付形式を使用します。|
| **LastWorkingDate** | 中断したユーザーの最後の作業日を指定します。 `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` [ISO 8601 の日付と時刻の形式](https://www.iso.org/iso-8601-date-and-time-format.html)を使用して、次の日付形式を使用します。|
|||

### <a name="csv-file-for-job-level-changes-data"></a>ジョブレベル変更データ用の CSV ファイル

次に、ジョブレベルのデータ変更の CSV ファイルの例を示します。

```text
EmailAddress,EffectiveDate,OldLevel,NewLevel
sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,Level 61 – Sr. Manager,Level 60- Manager
pillar@contoso.com,2019-04-23T15:18:02.4675041+05:30,Level 62 – Director,Level 60- Sr. Manager
```

次の表では、ジョブレベル変更データの CSV ファイルの各列について説明します。

|  列 | 説明 |
|:--------- |:------------- |
| **EmailAddress**  | ユーザーの電子メールアドレス (UPN) を指定します。|
| **EffectiveDate** | ユーザーの職務レベルが正式に変更された日付を指定します。 `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` [ISO 8601 の日付と時刻の形式](https://www.iso.org/iso-8601-date-and-time-format.html)を使用して、次の日付形式を使用します。|
| **注釈**| ジョブレベルの変更についてエバリュエーターが提供した注釈を指定します。 200文字の制限を入力できます。 このパラメーターは省略可です。 CSV ファイルに含める必要はありません。|
| **OldLevel**| 変更される前のユーザーのジョブレベルを指定します。 これは、フリーテキストパラメーターで、組織の階層分類を含めることができます。 このパラメーターは省略可です。 CSV ファイルに含める必要はありません。|
| **NewLevel**| 変更されたユーザーのジョブレベルを指定します。 これは、フリーテキストパラメーターで、組織の階層分類を含めることができます。 このパラメーターは省略可です。 CSV ファイルに含める必要はありません。|
|||

### <a name="csv-file-for-performance-review-data"></a>パフォーマンスレビューデータ用の CSV ファイル

パフォーマンスデータ用の CSV ファイルの例を次に示します。

```text
EmailAddress,EffectiveDate,Remarks,Rating
sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,Met expectations but bad attitude,2-Below expectation
pillar@contoso.com,2019-04-23T15:18:02.4675041+05:30, Multiple conflicts with the team
```

次の表では、パフォーマンスレビューデータ用の CSV ファイルの各列について説明します。

|  列 | 説明 |
|:----------|:--------------|
| **EmailAddress**  | ユーザーの電子メールアドレス (UPN) を指定します。|
| **EffectiveDate** | ユーザーが業績評価の結果について正式に通知した日付を指定します。 これは、業績評価サイクルが終了した日付になります。 `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` [ISO 8601 の日付と時刻の形式](https://www.iso.org/iso-8601-date-and-time-format.html)を使用して、次の日付形式を使用します。|
| **注釈**| パフォーマンスレビューのためにエバリュエーターがユーザーに提供したすべての注釈を指定します。 これは、200文字の制限があるテキストパラメーターです。 このパラメーターは省略可です。 CSV ファイルに含める必要はありません。|
| **評価**| 業績評価で提供される評価を指定します。 これはテキストパラメーターで、組織が評価を認識するために使用する自由形式のテキストを含めることができます。 たとえば、"3 は期待値を下回っています" または "2 の下の平均" のようになります。 これは、最大25文字のテキストパラメーターです。 このパラメーターは省略可です。 CSV ファイルに含める必要はありません。|
|||

### <a name="csv-file-for-performance-improvement-plan-data"></a>パフォーマンス向上計画データ用の CSV ファイル

ここでは、パフォーマンス向上計画のデータに関する CSV ファイルの例を示します。

```text
EmailAddress,EffectiveDate,ImprovementRemarks,PerformanceRating
sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,Met expectation but bad attitude,2-Below expectation
pillar@contoso.com,2019-04-23T15:18:02.4675041+05:30, Multiple conflicts with the team
```

次の表では、パフォーマンスレビューデータ用の CSV ファイルの各列について説明します。

|  列 |  説明 |
|:----------|:---------------|
| **EmailAddress**  | ユーザーの電子メールアドレス (UPN) を指定します。|
| **EffectiveDate** | ユーザーがパフォーマンス向上計画について正式に通知した日付を指定します。 `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` [ISO 8601 の日付と時刻の形式](https://www.iso.org/iso-8601-date-and-time-format.html)は、次の日付形式を使用する必要があります。|
| **注釈**| パフォーマンス向上計画に関してエバリュエーターが提供する注釈を指定します。 これは、200文字の制限があるテキストパラメーターです。 このパラメーターは省略可能です。 CSV ファイルに含める必要はありません。 |
| **評価**| 業績評価に関連する評価またはその他の情報を指定します。 パフォーマンス向上計画。 これはテキストパラメーターで、組織が評価を認識するために使用する自由形式のテキストを含めることができます。 たとえば、"3 は期待値を下回っています" または "2 の下の平均" のようになります。 これは、25文字の制限があるテキストパラメータです。 このパラメーターは省略可能です。 CSV ファイルに含める必要はありません。|
|||

### <a name="determining-how-many-csv-files-to-use-for-hr-data"></a>人事データに使用する CSV ファイルの数を決定する

手順3では、人事データの種類ごとに個別のコネクタを作成するか、すべてのデータ型に対して単一のコネクタを作成するかを選択できます。 1つの人事シナリオのデータを含む個別の CSV ファイルを使用できます (前のセクションで説明した CSV ファイルの例など)。 または、2つ以上の人事シナリオのデータを含む単一の CSV ファイルを使用することもできます。 人事データに使用する CSV ファイルの数を決定するのに役立つガイドラインを次に示します。

- 実装する insider リスク管理ポリシーに複数の HR データ型が必要な場合は、必要なすべてのデータ型を含む単一の CSV ファイルを使用することを検討してください。

- 人事データを生成または収集するメソッドは、CSV ファイルの数を決定する場合があります。 たとえば、人事コネクタを構成するために使用されるさまざまな種類の人事データが組織内の1つの人事システムに配置されている場合、データを1つの CSV ファイルにエクスポートすることができます。 しかし、データが異なる人事システムに分散されている場合は、データを別の CSV ファイルにエクスポートする方が簡単な場合があります。 たとえば、Employee resignation data は、ジョブレベルまたは業績評価データとは異なる人事システムに配置される場合があります。 この例では、データを1つの CSV ファイルに手動で結合するのではなく、CSV ファイルを個別に使用する方が簡単な場合があります。 そのため、人事システムからデータを取得またはエクスポートする方法によって、必要な CSV ファイルの数が決まる場合があります。

- 原則として、作成する必要がある HR コネクタの数は、CSV ファイルのデータ型によって決まります。 たとえば、内部的なリスク管理の実装をサポートするために必要なすべてのデータ型が CSV ファイルに含まれている場合は、1つの HR コネクタのみが必要になります。 しかし、それぞれが1つのデータ型を含む2つの CSV ファイルがある場合は、2つの HR コネクタを作成する必要があります。 これに対する例外として、 **Hrscenario** 列を csv ファイル (次のセクションを参照) に追加すると、異なる CSV ファイルを処理できる1つの HR コネクタを構成することができます。

### <a name="configuring-a-single-csv-file-for-multiple-hr-data-types"></a>複数の HR データ型に対して単一の CSV ファイルを構成する

複数の HR データ型を1つの CSV ファイルに追加することができます。 これは、を実装している insider リスク管理ソリューションで複数の人事データの種類が必要になる場合、またはデータ型が組織内の1つの人事システムに配置されている場合に便利です。 CSV ファイルが少ないほど、作成および管理する人事コネクタの数が少なくなります。

複数のデータ型を持つ CSV ファイルを構成するための要件を以下に示します。

- 各データ型に必要な列 (および使用する場合は省略可能) を追加する必要があります (ヘッダー行に対応する列名)。 データ型が列に対応していない場合は、値を空白のままにしておくことができます。

- 複数の種類の HR データを含む CSV ファイルを使用するには、hr コネクタは、どの種類の HR データを CSV ファイルに含めるかを指定する必要があります。 これは、CSV ファイルに追加の **Hrscenario** 列を追加することによって実現されます。 この列の値は、各行の人事データの種類を識別します。 たとえば、4つの人事シナリオに対応する値は、 \` Resignation \` 、 \` ジョブレベル \` の変更、 \` パフォーマンスのレビュー \` 、および \` パフォーマンスの改善計画 \` の場合があります。

- HRScenario * * 列を含む複数の CSV ファイルがある場合は、各ファイルが同じ列名と、特定の人事シナリオを識別する同じ値を使用していることを確認してください。

次の例は、 **Hrscenario** 列を含む CSV ファイルを示しています。 HRScenario 列の値は、対応する行のデータの種類を識別します。

```text
HRScenario,EmailAddress,ResignationDate,LastWorkingDate,EffectiveDate,Remarks,Rating,OldLevel,NewLevel
Resignation,sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,2019-04-29T15:18:02.4675041+05:30,,,,
Resignation,pilarp@contoso.com,2019-04-24T09:15:49Z,2019-04-29T15:18:02.7117540,,,,
Job level change,sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,,,,,Level 61 Sr. Manager, Level 60 Manager
Job level change,pillarp@contoso.com,2019-04-23T15:18:02.4675041+05:30,,,,,Level 62 Director,Level 60 Sr Manager
Performance review,sarad@contoso.com,,,2019-04-23T15:18:02.4675041+05:30,Met expectation but bad attitude,2 Below expectations,,
Performance review,pillarp@contoso.com,,,2019-04-23T15:18:02.4675041+05:30, Multiple conflicts with the team,,
Performance improvement plan,sarad@contoso.com,,,2019-04-23T15:18:02.4675041+05:30,Met expectations but bad attitude,2 Below expectations,,
Performance improvement plan,pillarp@contoso.com,,,2019-04-23T15:18:02.4675041+05:30,Multiple conflicts with the team,,
```

> [!NOTE]
> この場合は、手順3でコネクタを設定するときに HR データ型を識別する列として CSV ファイルの列の名前をマップするので、HR データ型を識別する列に任意の名前を使用できます。 コネクタを設定するときに、[データ型] 列に使用される値をマップすることもできます。

### <a name="adding-the-hrscenario-column-to-a-csv-file-that-contains-a-single-data-type"></a>1つのデータ型を含む CSV ファイルに HRScenario 列を追加する

組織の人事システムおよび人事データを CSV ファイルにエクスポートする方法に基づいて、1つの HR データ型を含む複数の CSV ファイルを作成することが必要になる場合があります。 この場合も、1つの HR コネクタを作成して、別の CSV ファイルからデータをインポートすることができます。 これを行うには、CSV ファイルに HRScenario 列を追加し、HR データ型を指定するだけで済みます。 その後、各 CSV ファイルに対してスクリプトを実行できますが、コネクタに対して同じジョブ ID を使用します。 [手順 4](#step-4-run-the-sample-script-to-upload-your-hr-data)を参照してください。

## <a name="step-2-create-an-app-in-azure-active-directory"></a>手順 2: Azure Active Directory でアプリを作成する

次の手順では、Azure Active Directory (Azure AD) で新しいアプリを作成し、登録します。 アプリは、手順3で作成した HR コネクタに対応します。 このアプリを作成すると、Azure AD は、組織へのアクセスを試行しているときに、HR コネクタを認証できるようになります。 このアプリは、手順4で実行して人事データを Microsoft クラウドにアップロードするスクリプトを認証するためにも使用されます。 この Azure AD アプリの作成時には、必ず次の情報を保存してください。 これらの値は、手順3と手順4で使用されます。

- Azure AD アプリケーション ID ( *アプリ id* または *クライアント id* とも呼ばれる)

- Azure AD アプリケーションシークレット ( *クライアントシークレット* とも呼ばれる)

- テナント Id ( *ディレクトリ id* とも呼ばれる)

Azure AD でアプリを作成するための詳細な手順については、「 [Microsoft identity platform を使用](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app)してアプリケーションを登録する」を参照してください。

## <a name="step-3-create-the-hr-connector"></a>手順 3: HR コネクタを作成する

次の手順では、Microsoft 365 コンプライアンスセンターで人事コネクタを作成します。 手順4でスクリプトを実行すると、作成した HR コネクタが、CSV ファイルの人事データを Microsoft 365 組織に取り込みます。 コネクタを作成する前に、人事シナリオの一覧と、それぞれに対応する CSV 列名があることを確認してください。 コネクタを構成するときには、各シナリオに必要なデータを CSV ファイルの実際の列名にマップする必要があります。 または、コネクタを構成するときにサンプルの CSV ファイルをアップロードし、ウィザードを使用して列の名前を必要なデータ型にマップすることもできます。

この手順を完了したら、コネクタの作成時に生成されたジョブ ID を必ずコピーしてください。 スクリプトを実行するときに、ジョブ ID を使用します。

1. に移動し [https://compliance.microsoft.com](https://compliance.microsoft.com/) 、左側のナビゲーションで [ **データコネクタ** ] をクリックします。

2. [ **データコネクタ** ] ページの [ **HR** ] で、[ **表示** ] をクリックします。

3. [ **人事] カスタム** ページで、[ **コネクタの追加** ] をクリックします。

4. [ **接続の設定** ] ページで、次の操作を実行し、[ **次へ** ] をクリックします。

   1. 手順2で作成した Azure アプリケーションの Azure AD アプリケーション ID を入力するか貼り付けます。

   1. HR コネクタの名前を入力します。

5. [人事シナリオ] ページで、データをインポートする1つまたは複数の HR シナリオを選択し、[ **次へ** ] をクリックします。

6. [ファイルマッピング方法] ページで、次のいずれかのオプションを選択し、[ **次へ** ] をクリックします。

   - **サンプルファイルをアップロード** します。 このオプションを選択した場合は、[ **サンプルファイルのアップロード** ] をクリックして、手順1で準備した CSV ファイルをアップロードします。 このオプションを使用すると、CSV ファイルの列名をドロップダウンリストからすばやく選択して、以前に選択した人事シナリオのデータ型にマップできます。

   または

   - **マッピングの詳細を手動で提供** します。 このオプションを選択する場合は、CSV ファイル内の列の名前を入力して、以前に選択した人事シナリオのデータ型にマップする必要があります。

7. [ファイルマッピングの詳細] ページで、サンプルの CSV ファイルをアップロードしたかどうか、または1つの HR シナリオに対してコネクタを構成しているか、複数のシナリオに対してコネクタを構成しているかに応じて、次のいずれかの操作を行います。 サンプルファイルをアップロードした場合は、列名を入力する必要はありません。 ドロップダウンリストから選択します。

    - 前の手順で1つの HR シナリオを選択した場合は、各ボックスに、手順1で作成した CSV ファイルから、列ヘッダー名 ( *パラメーター* とも呼ばれます) を入力します。 入力した列名の大文字と小文字は区別されませんが、CSV ファイル内の列名にスペースが含まれている場合は、必ずスペースを含めてください。 前述のように、これらのボックスに入力する名前は、CSV ファイルのパラメーター名と一致している必要があります。 たとえば、次のスクリーンショットは、ステップ1で示されている employee resignation HR シナリオのサンプル CSV ファイルのパラメーター名を示しています。

    - 上記の手順で複数のデータ型を選択した場合は、CSV ファイルで HR データ型を識別する識別子列名を入力する必要があります。 [識別子] 列の名前を入力した後、この HR データ型を識別する値を入力し、選択したデータ型に対応する各ボックスの各ボックスに、手順1で作成した CSV ファイルから選択したデータ型の列ヘッダー名を入力します。 前述のように、これらのボックスに入力する名前は、CSV ファイルの列名と一致している必要があります。

8. [ **レビュー** ] ページで、設定を確認し、[ **完了** ] をクリックしてコネクタを作成します。

   コネクタが作成されたことを確認する [状態] ページが表示されます。 このページには、次の手順を完了し、人事データをアップロードするサンプルスクリプトを実行するために必要な2つの重要な事項が含まれています。

   ![ジョブ ID を使用してページを確認し、サンプルスクリプトの github へのリンク](../media/HRConnector_Confirmation.png)

   1. **ジョブ ID。** このジョブ ID は、次の手順でスクリプトを実行するために必要になります。 このページからコピーするか、コネクタのポップアップページからコピーすることができます。

   1. **サンプルスクリプトにリンクします。** サンプルスクリプトにアクセスするには、 **次** のリンクをクリックして、GitHub サイトに移動します (リンクは新しいウィンドウを開きます)。 このウィンドウを開いたままにして、手順4でスクリプトをコピーできるようにします。 または、スクリプトを実行するときにアクセスできるように、移動先にブックマークを付けたり、URL をコピーしたりすることもできます。 このリンクは、コネクタのフライアウトページでも使用できます。

9. **[完了]** をクリックします。

   新しいコネクタが [ **コネクタ** ] タブの一覧に表示されます。

10. 作成した HR コネクタをクリックすると、フライアウトページが表示され、コネクタに関するプロパティやその他の情報が表示されます。

   ![新しい HR コネクタのフライアウトページ](../media/HRConnectorWizard7.png)

まだ実行していない場合は、 **Azure アプリケーション id** と **コネクタジョブ ID** の値をコピーできます。 次の手順でスクリプトを実行するには、これらが必要になります。 また、スクリプトは、フライアウトページからダウンロードすることもできます (または、次の手順のリンクを使用してダウンロードすることもできます)。

[ **編集** ] をクリックして、[ **ファイルマッピング** ] ページで定義した Azure アプリケーション ID または列ヘッダー名を変更することもできます。

## <a name="step-4-run-the-sample-script-to-upload-your-hr-data"></a>手順 4: サンプルスクリプトを実行して人事データをアップロードする

HR コネクタを設定する最後の手順は、Microsoft クラウドに (手順1で作成した) CSV ファイル内の人事データをアップロードするサンプルスクリプトを実行することです。 具体的には、スクリプトは HR コネクタにデータをアップロードします。 スクリプトを実行すると、手順3で作成した HR コネクタが人事データを Microsoft 365 組織にインポートします。これにより、他のコンプライアンスツール (Insider リスク管理ソリューションなど) からアクセスできるようになります。 スクリプトを実行した後、毎日自動的に実行されるようにタスクをスケジュールすることを検討してください。これにより、最新の従業員の終了データが Microsoft クラウドにアップロードされます。 [[スクリプトを自動的に実行するようにスケジュールする」を](#optional-step-6-schedule-the-script-to-run-automatically)参照してください。

1. 前の手順で開いたままにしたウィンドウに移動し、サンプルスクリプトを使用して GitHub サイトにアクセスします。 または、ブックマークを作成したサイトを開くか、コピーした URL を使用します。

2. [ **Raw** ] ボタンをクリックすると、スクリプトがテキストビューに表示されます。

3. サンプルスクリプトのすべての行をコピーして、テキストファイルに保存します。

4. 必要に応じて、組織のサンプルスクリプトを変更します。

5. ファイル名のサフィックスを使用して、テキストファイルを Windows PowerShell スクリプトファイルとして保存し `.ps1` ます (例:) `HRConnector.ps1` 。

6. ローカルコンピューターでコマンドプロンプトを開き、スクリプトを保存したディレクトリに移動します。

7. 次のコマンドを実行して、CSV ファイル内の人事データを Microsoft クラウドにアップロードします。例えば：

    ```powershell
    .\HRConnector.ps1 -tenantId <tenantId> -appId <appId>  -appSecret <appSecret>  -jobId <jobId>  -csvFilePath '<csvFilePath>'
    ```

   次の表では、このスクリプトで使用するパラメーターと、必要な値について説明します。 前の手順で取得した情報は、これらのパラメーターの値で使用されます。

   | パラメーター | 説明 |
   |:-----|:-----|:-----|
   |`tenantId`|これは、手順2で取得した Microsoft 365 組織の Id です。 Azure AD 管理センターの **概要** ブレードで、組織のテナント Id を取得することもできます。 これは、組織を識別するために使用されます。|
   |`appId` |これは、手順2で Azure AD で作成したアプリの Azure AD アプリケーション Id です。 これは、スクリプトが Microsoft 365 組織にアクセスしようとするときに、Azure AD によって認証に使用されます。 | 
   |`appSecret`|これは、手順2で Azure AD で作成したアプリの Azure AD アプリケーションシークレットです。 これは認証にも使用されます。|
   |`jobId`|これは、手順3で作成した HR コネクタのジョブ ID です。 これは、HR コネクタを使用して、Microsoft クラウドにアップロードされる人事データを関連付けるために使用されます。|
   |`csvFilePath`|これは、手順1で作成した CSV ファイル (スクリプトと同じシステムに格納されている) のファイルパスです。 ファイルパスにスペースを含めないでください。それ以外の場合は、単一引用符を使用します。|
   |||

   次の例では、各パラメーターに実際の値を使用して、HR コネクタスクリプトの構文を示します。

   ```powershell
    .\HRConnector.ps1 -tenantId d5723623-11cf-4e2e-b5a5-01d1506273g9 -appId 29ee526e-f9a7-4e98-a682-67f41bfd643e -appSecret MNubVGbcQDkGCnn -jobId b8be4a7d-e338-43eb-a69e-c513cd458eba -csvFilePath 'C:\Users\contosoadmin\Desktop\Data\employee_termination_data.csv'
    ```

   アップロードが成功すると、[ **アップロードに成功しまし** た] メッセージがスクリプトに表示されます。

   > [!NOTE]
   > 実行ポリシーのために上記のコマンドの実行に問題がある場合は、実行ポリシーの設定に関するガイダンスについては、「 [実行ポリシーについ](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_execution_policies) て」と「 [ExecutionPolicy](https://docs.microsoft.com/powershell/module/microsoft.powershell.security/set-executionpolicy) 」を参照してください。

## <a name="step-5-monitor-the-hr-connector"></a>手順 5: HR コネクタを監視する

HR コネクタを作成し、人事データをアップロードするスクリプトを実行した後、Microsoft 365 コンプライアンスセンターでコネクタとアップロードの状態を表示できます。 定期的にスクリプトを自動的に実行するようにスケジュールする場合は、最後にスクリプトを実行した後に現在の状態を表示することもできます。

1. [https://compliance.microsoft.com](https://compliance.microsoft.com)左側のナビゲーションに移動し、[ **データコネクタ** ] をクリックします。

2. [ **コネクタ** ] タブをクリックし、[HR] コネクタを選択して、フライアウトページを表示します。 このページには、コネクタに関するプロパティと情報が含まれています。

   ![プロパティと状態を含む HR コネクタのポップアップページ](../media/HRConnectorFlyout1.png)

3. [ **進行状況** ] で、[ **ログのダウンロード** ] リンクをクリックして、コネクタの状態ログを開く (または保存) します。 このログには、スクリプトが実行されるたびに関する情報が含まれ、CSV ファイルのデータを Microsoft クラウドにアップロードします。 

   ![HR コネクタログファイルアップロードされた CSV ファイルの行数を表示します。](../media/HRConnectorLogFile.png)

   フィールドは、アップロードされ `RecordsSaved` た CSV ファイルの行数を示します。 たとえば、CSV ファイルに4つの行が含まれている場合、 `RecordsSaved` フィールドの値は、スクリプトが正常に csv ファイルのすべての行をアップロードした場合は4です。

手順4でスクリプトを実行していない場合は、スクリプトをダウンロードするためのリンクが [ **前回のインポート** ] の下に表示されます。 スクリプトをダウンロードし、手順に従ってスクリプトを実行できます。

## <a name="optional-step-6-schedule-the-script-to-run-automatically"></a>オプション手順 6: スクリプトが自動的に実行されるようにスケジュールする

組織からの最新の人事データを insider リスク管理ソリューションなどのツールが使用できるようにするには、1日1回など、定期的にスクリプトを自動的に実行するようにスケジュールすることをお勧めします。 また、この場合は、CSV ファイル内の人事データを同じスケジュール (同じではない場合) に更新して、組織を退職する従業員に関する最新情報が含まれるようにする必要があります。 目標は、HR コネクタが insider リスク管理ソリューションで利用できるようにするために、最新の人事データをアップロードすることです。

Windows でタスクスケジューラアプリを使用して、スクリプトを毎日自動的に実行することができます。

1. ローカルコンピューターで、Windows の [ **スタート** ] ボタンをクリックし、[ **タスクスケジューラ** ] を入力します。

2. **タスクスケジューラ** アプリをクリックして開きます。

3. [ **アクション** ] セクションで、[ **タスクの作成** ] をクリックします。

4. [ **全般** ] タブで、スケジュールされたタスクのわかりやすい名前を入力します。たとえば、 **HR Connector スクリプト** を使用します。 また、オプションの説明を追加することもできます。

5. [ **セキュリティオプション** ] で、次の操作を行います。

   1. ログオンしているかどうかにかかわらず、コンピューターにログオンしている場合または実行した場合にのみスクリプトを実行するかどうかを決定します。

   1. [ **最上位の特権で実行** する] チェックボックスがオンになっていることを確認します。

6. [ **トリガー** ] タブを選択し、[ **新規** ] をクリックして、次の操作を行います。

   1. [ **設定** ] で [ **毎日** ] オプションを選択し、スクリプトを初めて実行する日付と時刻を選択します。 このスクリプトは毎日、指定した時刻に実行されます。

   1. [ **詳細設定** ] で、[ **有効** ] チェックボックスがオンになっていることを確認します。

   1. [ **OK** ] をクリックします。

7. [ **Actions** ] タブを選択し、[ **新規** ] をクリックして、次の操作を行います。

   ![HR connector スクリプトの新しいスケジュールされたタスクを作成するためのアクションの設定](../media/HRConnectorScheduleTask1.png)

   1. [ **アクション** ] ドロップダウンリストで、[ **プログラムの開始** ] が選択されていることを確認してください。

   1. [ **プログラム/スクリプト** ] ボックスで [ **参照** ] をクリックし、次の場所に移動して、ボックスにパスが表示されるように `C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe` します。

   1. [ **引数を追加する (省略可能)** ] ボックスに、手順4で実行したのと同じスクリプトコマンドを貼り付けます。 たとえば、`.\HRConnector.ps1 -tenantId "d5723623-11cf-4e2e-b5a5-01d1506273g9" -appId "c12823b7-b55a-4989-faba-02de41bb97c3" -appSecret "MNubVGbcQDkGCnn"  -jobId "e081f4f4-3831-48d6-7bb3-fcfab1581458" -csvFilePath "C:\Users\contosoadmin\Desktop\Data\employee_termination_data.csv"` のように指定します。

   1. [ **開始 (省略可能)** ] ボックスに、手順4で実行したスクリプトのフォルダーの場所を貼り付けます。 たとえば、`C:\Users\contosoadmin\Desktop\Scripts` のようにします。

   1. [ **Ok]** をクリックして、新しいアクションの設定を保存します。

8. [ **タスクの作成** ] ウィンドウで、[ **Ok** ] をクリックして、スケジュールされたタスクを保存します。 ユーザーアカウントの資格情報の入力を求められる場合があります。

   タスクスケジューラライブラリに新しいタスクが表示されます。

   ![タスクスケジューラライブラリに新しいタスクが表示されます。](../media/HRConnectorTaskSchedulerLibrary.png)

   前回スクリプトが実行された日時と、次回の実行スケジュールが表示されます。 タスクをダブルクリックすると、そのタスクを編集できます。

   また、コンプライアンスセンターの対応する HR コネクタのフライアウトページで、最後にスクリプトが実行された日時を確認することもできます。

## <a name="existing-hr-connectors"></a>既存の人事コネクタ

2020年7月20日に、HR コネクタでサポートされているその他のシナリオをリリースしました。 これらは、この記事で既に説明した人事シナリオです。 この日付以前に作成された人事コネクタは、Employee resignation シナリオのみをサポートします。 2020年7月20日より前に HR コネクタを作成した場合は、人事データを Microsoft クラウドに移行し続けるように移行しています。 この機能を維持するために、何もする必要はありません。 引き続きコネクタを使用することはできますが、停止することはありません。

追加の人事シナリオを実装する場合は、新しい HR コネクタを作成し、リリースされた追加の人事シナリオに備えて構成してください。 また、追加の人事シナリオをサポートするためのデータを含む、1つ以上の新しい CSV ファイルを作成する必要があります。 新しい HR コネクタを作成した後、追加の人事シナリオのデータを含む新しいコネクタおよび CSV ファイルのジョブ ID を使用してスクリプトを実行します。
