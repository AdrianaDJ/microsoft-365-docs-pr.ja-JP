---
title: Office 365 の顧客キーの可用性キーについて
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 02/05/2020
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
description: 紛失した Office 365 顧客キーを回復するために使用される可用性キーについて説明します。
ms.openlocfilehash: 72fbfd139b273d38a0cb017d7bbca3d87c16efb2
ms.sourcegitcommit: 570ad1c7c334476ecec00dc355dfe52e8c2bb87b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/08/2020
ms.locfileid: "41862087"
---
# <a name="learn-about-the-availability-key-for-office-365-customer-key"></a><span data-ttu-id="5d557-103">Office 365 の顧客キーの可用性キーについて</span><span class="sxs-lookup"><span data-stu-id="5d557-103">Learn about the availability key for Office 365 Customer Key</span></span>

<span data-ttu-id="5d557-104">可用性キーは、データ暗号化ポリシーの作成時に自動的に生成され、プロビジョニングされるルートキーです。</span><span class="sxs-lookup"><span data-stu-id="5d557-104">The availability key is a root key automatically generated and provisioned when you create a data encryption policy.</span></span> <span data-ttu-id="5d557-105">Office 365 は、可用性キーを格納して保護します。</span><span class="sxs-lookup"><span data-stu-id="5d557-105">Office 365 stores and protects the availability key.</span></span> <span data-ttu-id="5d557-106">可用性キーは、顧客キーを使用してサービス暗号化を行うために提供する2つのルートキーと同じように機能します。</span><span class="sxs-lookup"><span data-stu-id="5d557-106">The availability key is functionally like the two root keys that you supply for service encryption with Customer Key.</span></span> <span data-ttu-id="5d557-107">可用性キーは、キー階層の1層下のキーをラップします。</span><span class="sxs-lookup"><span data-stu-id="5d557-107">The availability key wraps the keys one tier lower in the key hierarchy.</span></span> <span data-ttu-id="5d557-108">Azure Key Vault で提供および管理するキーとは異なり、可用性キーに直接アクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="5d557-108">Unlike the keys that you provide and manage in Azure Key Vault, you can't directly access the availability key.</span></span> <span data-ttu-id="5d557-109">Office 365 の自動サービスは、PowerShell コマンドレットを使用して可用性キーを管理します。</span><span class="sxs-lookup"><span data-stu-id="5d557-109">Office 365 automated services manage the availability key using PowerShell cmdlets.</span></span> <span data-ttu-id="5d557-110">これらのコマンドレットは、可用性キーへの直接アクセスを伴わない自動操作を開始します。</span><span class="sxs-lookup"><span data-stu-id="5d557-110">These cmdlets initiate automated operations that never involve direct access to the availability key.</span></span>

<span data-ttu-id="5d557-111">可用性キーの主な目的は、管理している予期しないルートキーから回復機能を提供することです。</span><span class="sxs-lookup"><span data-stu-id="5d557-111">The primary purpose of the availability key is to provide recovery capability from the unanticipated loss of root keys that you manage.</span></span> <span data-ttu-id="5d557-112">Mismanagement または悪意のあるアクションの結果が失われる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="5d557-112">Loss could be a result of mismanagement or malicious action.</span></span> <span data-ttu-id="5d557-113">ルートキーを制御できなくなった場合は、Microsoft サポートに連絡して、可用性キーを使用した回復のプロセスを支援します。</span><span class="sxs-lookup"><span data-stu-id="5d557-113">If you lose control of your root keys, contact Microsoft Support and Microsoft will assist you through the process of recovery using the availability key.</span></span> <span data-ttu-id="5d557-114">可用性キーを使用して、新しいデータ暗号化ポリシーに、プロビジョニングする新しいルートキーを使用して移行します。</span><span class="sxs-lookup"><span data-stu-id="5d557-114">You'll use the availability key to migrate to a new Data Encryption Policy with new root keys you provision.</span></span>

<span data-ttu-id="5d557-115">可用性キーのストレージと制御は、次の3つの理由から、Azure Key Vault キーとは意図的に異なります。</span><span class="sxs-lookup"><span data-stu-id="5d557-115">Storage and control of the availability key are deliberately different from Azure Key Vault keys for three reasons:</span></span>

- <span data-ttu-id="5d557-116">可用性キーは、両方の Azure キーヴォールトキーを制御することができない場合の回復、"破損ガラス" 機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="5d557-116">The availability key provides a recovery, "break-glass" capability if control over both Azure Key Vault keys is lost.</span></span>
- <span data-ttu-id="5d557-117">論理コントロールと安全な格納場所の分離により、多層防御が提供され、単一の攻撃または障害点から、すべてのキーとデータが失われないように保護されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-117">The separation of logical controls and secure storage locations provides defense-in-depth and protects against the loss of all keys, and your data, from a single attack or point of failure.</span></span>
- <span data-ttu-id="5d557-118">可用性キーは、一時的なエラーのために Office 365 サービスが Azure Key Vault でホストされているキーに到達できない場合、高可用性機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="5d557-118">The availability key provides a high-availability capability if Office 365 services are unable to reach keys hosted in Azure Key Vault due to transient errors.</span></span> <span data-ttu-id="5d557-119">このルールは、Exchange Online と Skype for Business サービスの暗号化にのみ適用されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-119">This rule only applies to Exchange Online and Skype for Business service encryption.</span></span> <span data-ttu-id="5d557-120">SharePoint Online、OneDrive for Business、および Teams ファイルは、回復プロセスを開始することを明示的に指示しない限り、可用性キーを使用しません。</span><span class="sxs-lookup"><span data-stu-id="5d557-120">SharePoint Online, OneDrive for Business, and Teams files never use the availability key unless you explicitly instruct Microsoft to initiate the recovery process.</span></span>

<span data-ttu-id="5d557-121">キー管理のためのさまざまな保護とプロセスを使用して、データを保護する責任を共有することにより、最終的にすべてのキー (つまりデータ) が完全に失われたり破壊されたりするリスクを軽減します。</span><span class="sxs-lookup"><span data-stu-id="5d557-121">Sharing the responsibility to protect your data, using a variety of protections and processes for key management, ultimately reduces the risk that all keys (and therefore your data) will be permanently lost or destroyed.</span></span> <span data-ttu-id="5d557-122">Microsoft は、サービスを終了するときに、可用性キーの disablement または破壊に関してのみ権限を提供します。</span><span class="sxs-lookup"><span data-stu-id="5d557-122">Microsoft provides you with sole authority over the disablement or destruction of the availability key when you leave the service.</span></span> <span data-ttu-id="5d557-123">設計上、Microsoft では可用性キーにアクセスできるのはありません。これは、Office 365 サービスコードによってのみアクセス可能です。</span><span class="sxs-lookup"><span data-stu-id="5d557-123">By design, no one at Microsoft has access to the availability key: it is only accessible by Office 365 service code.</span></span>

<span data-ttu-id="5d557-124">キーをセキュリティで保護する方法の詳細については、 [Microsoft Trust Center](https://www.microsoft.com/trustcenter/Privacy/govt-requests-for-data)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5d557-124">See the [Microsoft Trust Center](https://www.microsoft.com/trustcenter/Privacy/govt-requests-for-data) for more information about how we secure keys.</span></span>
  
## <a name="availability-key-uses"></a><span data-ttu-id="5d557-125">可用性キーの用途</span><span class="sxs-lookup"><span data-stu-id="5d557-125">Availability key uses</span></span>

<span data-ttu-id="5d557-126">可用性キーは、外部のマルウェアまたは悪意のある insider がキーコンテナーの制御を盗み出た場合、または不注意に mismanagement によってルートキーが失われた場合に、回復機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="5d557-126">The availability key provides recovery capability for scenarios in which an external malefactor or malicious insider steals control of your key vault, or when inadvertent mismanagement results in loss of root keys.</span></span> <span data-ttu-id="5d557-127">この回復機能は、顧客キーと互換性のあるすべての Office 365 サービスに適用されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-127">This recovery capability applies to all Office 365 services compatible with Customer Key.</span></span> <span data-ttu-id="5d557-128">個別のサービスでは、可用性キーが異なる方法で使用されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-128">Individual services use the availability key differently.</span></span> <span data-ttu-id="5d557-129">Office 365 は、以下に示す方法で可用性キーのみを使用します。</span><span class="sxs-lookup"><span data-stu-id="5d557-129">Office 365 only uses the availability key in the ways described below.</span></span>

### <a name="exchange-online-and-skype-for-business-uses"></a><span data-ttu-id="5d557-130">Exchange Online と Skype for Business の用途</span><span class="sxs-lookup"><span data-stu-id="5d557-130">Exchange Online and Skype for Business uses</span></span>

<span data-ttu-id="5d557-131">回復機能に加えて、Exchange Online と Skype for Business は可用性キーを使用して、一時的なデータ可用性を確保したり、運用上の問題が断続的に発生したり、ルートキーにアクセスするサービスに関連したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="5d557-131">In addition to the recovery capability, Exchange Online and Skype for Business use the availability key to ensure data availability during transient, or intermittent operational issues, related to the service accessing root keys.</span></span> <span data-ttu-id="5d557-132">一時的なエラーのために、サービスが Azure Key Vault の顧客キーのいずれかに到達できない場合、サービスは自動的に可用性キーを使用します。</span><span class="sxs-lookup"><span data-stu-id="5d557-132">When the service cannot reach either of your Customer Keys in Azure Key Vault due to transient errors, the service automatically uses the availability key.</span></span> <span data-ttu-id="5d557-133">サービスが可用性キーに直接到達することはありません。</span><span class="sxs-lookup"><span data-stu-id="5d557-133">The service NEVER goes directly to the availability key.</span></span>

<span data-ttu-id="5d557-134">Exchange Online および Skype for Business の自動システムでは、一時的なエラー時に可用性キーを使用して、ウイルス対策、電子情報損失防止、メールボックスの移動、データのインデックス作成などの自動化されたバックエンドサービスをサポートできます。</span><span class="sxs-lookup"><span data-stu-id="5d557-134">Automated systems in Exchange Online and Skype for Business may use the availability key during transient errors to support automated back-end services such as anti-virus, e-discovery, data loss prevention, mailbox moves, and data indexing.</span></span>

### <a name="sharepointonlineonedriveforbusinessandteamsfiles-uses"></a><span data-ttu-id="5d557-135">SharePoint Online、OneDrive for Business、および Teams のファイルの用途</span><span class="sxs-lookup"><span data-stu-id="5d557-135">SharePoint Online, OneDrive for Business, and Teams files uses</span></span>

<span data-ttu-id="5d557-136">SharePoint Online、OneDrive for Business、Teams ファイルでは、可用性キーは復旧機能の外部では使用されず、お客様は、復旧シナリオで可用性キーの使用を開始するように明示的に指示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5d557-136">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability and customers must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span> <span data-ttu-id="5d557-137">自動化されたサービス操作は、Azure Key vault の顧客キーにのみ依存します。</span><span class="sxs-lookup"><span data-stu-id="5d557-137">Automated service operations solely rely on your Customer Keys in Azure Key vault.</span></span> <span data-ttu-id="5d557-138">これらのサービスにおけるキー階層のしくみの詳細については、「 [SharePoint Online、OneDrive For business、および Teams の各ファイルが可用性キーを使用する方法](#how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5d557-138">For in-depth information about how the key hierarchy works for these services, see [How SharePoint Online, OneDrive for Business, and Teams files use the availability key](#how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key).</span></span>

## <a name="availability-key-security"></a><span data-ttu-id="5d557-139">可用性キーのセキュリティ</span><span class="sxs-lookup"><span data-stu-id="5d557-139">Availability key security</span></span>

<span data-ttu-id="5d557-140">Microsoft では、可用性キーをインスタンス化し、それを保護するために大きな手段を講じることによって、データ保護の責任を負っています。</span><span class="sxs-lookup"><span data-stu-id="5d557-140">Microsoft shares the responsibility of data protection with you by instantiating the availability key and taking extensive measures to protect it.</span></span> <span data-ttu-id="5d557-141">Microsoft は、お客様に可用性キーの直接制御を公開しません。</span><span class="sxs-lookup"><span data-stu-id="5d557-141">Microsoft does not expose direct control of the availability key to customers.</span></span> <span data-ttu-id="5d557-142">たとえば、Azure Key Vault で所有するキーのみをロール (回転) することができます。</span><span class="sxs-lookup"><span data-stu-id="5d557-142">For example, you can only roll (rotate) the keys that you own in Azure Key Vault.</span></span> <span data-ttu-id="5d557-143">詳細については、「 [customer key または availability キーをロールまたは回転する](customer-key-availability-key-roll.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5d557-143">For more information, see [Roll or rotate a customer key or an availability key](customer-key-availability-key-roll.md).</span></span>

### <a name="availability-key-secret-stores"></a><span data-ttu-id="5d557-144">可用性キーシークレットストア</span><span class="sxs-lookup"><span data-stu-id="5d557-144">Availability key secret stores</span></span>

<span data-ttu-id="5d557-145">Microsoft は、顧客に接している Azure Key Vault のような、アクセス制御された内部シークレットストアの可用性キーを保護します。</span><span class="sxs-lookup"><span data-stu-id="5d557-145">Microsoft protects availability keys in access-controlled, internal secret stores like the customer-facing Azure Key Vault.</span></span> <span data-ttu-id="5d557-146">アクセス制御を実装することで、Microsoft の管理者は、に含まれる機密情報に直接アクセスすることができなくなります。</span><span class="sxs-lookup"><span data-stu-id="5d557-146">We implement access controls to prevent Microsoft administrators from directly accessing the secrets contained within.</span></span> <span data-ttu-id="5d557-147">キーのローテーション、削除、取得などのシークレットストア操作は、可用性キーへの直接アクセスを伴わない自動コマンドによって行われます。</span><span class="sxs-lookup"><span data-stu-id="5d557-147">Secret Store operations, including key rotation, deletion, and retrieval occur through automated commands that never involve direct access to the availability key.</span></span> <span data-ttu-id="5d557-148">これらのコマンドを調整するためのアクセスは、特定のエンジニアに限定され、内部ツールのロックボックスを使用した特権のエスカレーションを必要とします。</span><span class="sxs-lookup"><span data-stu-id="5d557-148">Access to adjust these commands is limited to specific engineers and requires privilege escalation through an internal tool, Lockbox.</span></span> <span data-ttu-id="5d557-149">特権の昇格を行うには、上司の承認と根拠を付与する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5d557-149">Privilege escalation requires manager approval and justification prior to being granted.</span></span> <span data-ttu-id="5d557-150">ロックボックスアクセスは、時間の満了時またはエンジニアのログアウト時に、自動的にアクセスが失効した時間に制限されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-150">Lockbox ensures access is time bound with automatic access revocation upon time expiration or engineer log out.</span></span>

<span data-ttu-id="5d557-151">**Exchange Online と Skype For business の**可用性キーは、Active Directory シークレットストアに格納されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-151">**Exchange Online and Skype for Business** availability keys are stored in an Active Directory secret store.</span></span> <span data-ttu-id="5d557-152">Exchange Online の Active Directory は、オブジェクト、id、およびデータを含むトラフィックおよび容量のフォレストをルーティングする管理フォレストから構成されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-152">Exchange Online Active Directory is comprised of Management forests that route traffic and Capacity forests that contain objects, identities, and data.</span></span> <span data-ttu-id="5d557-153">容量フォレストは、アカウントフォレストとリソースフォレストから構成されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-153">Capacity forests consist of Account forests and Resource forests.</span></span> <span data-ttu-id="5d557-154">アカウントフォレストには、互いに同期された複数の容量のドメインコントローラーがあります。</span><span class="sxs-lookup"><span data-stu-id="5d557-154">Account forests have multiple Capacity domain controllers that are synced with one another.</span></span> <span data-ttu-id="5d557-155">可用性キーは、これらの容量のドメインコントローラー内に安全に格納されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-155">Availability keys are securely stored within these Capacity domain controllers.</span></span> <span data-ttu-id="5d557-156">このセキュリティで保護された格納場所は、SharePoint Online、OneDrive for Business、および Teams ファイルシークレットストアとは別の場所に分離されています。</span><span class="sxs-lookup"><span data-stu-id="5d557-156">This secure storage location is separate and isolated from the SharePoint Online, OneDrive for Business, and Teams files secret store.</span></span>

<span data-ttu-id="5d557-157">**SharePoint Online、OneDrive For business、および Teams ファイル**の可用性キーは、サービスチームが管理する内部シークレットストアに格納されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-157">**SharePoint Online, OneDrive for Business, and Teams files** availability keys are stored in an internal secret store managed by the service team.</span></span> <span data-ttu-id="5d557-158">このセキュリティで保護された機密ストレージサービスには、アプリケーションエンドポイントを使用するフロントエンドサーバーと、バックエンドとして SQL データベースがあります。</span><span class="sxs-lookup"><span data-stu-id="5d557-158">This secured, secrets storage service has front-end servers with application endpoints and a SQL Database as the back end.</span></span> <span data-ttu-id="5d557-159">可用性キーは、SQL データベースに格納され、保持 (暗号化) されて、AES-256 と HMAC の組み合わせを使用して、残りの可用性キーを暗号化します。</span><span class="sxs-lookup"><span data-stu-id="5d557-159">Availability keys are stored in the SQL Database and are wrapped (encrypted) by secret store encryption keys that use a combination of AES-256 and HMAC to encrypt the availability key at rest.</span></span> <span data-ttu-id="5d557-160">シークレットストアの暗号化キーは、同じ SQL データベースの論理的に分離されたコンポーネントに格納され、Microsoft の証明機関 (CA) によって管理される証明書に含まれる RSA 2048 キーを使用してさらに暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-160">The secret store encryption keys are stored in a logically isolated component of the same SQL Database and are further encrypted with RSA-2048 keys contained in certificates managed by the Microsoft certificate authority (CA).</span></span> <span data-ttu-id="5d557-161">これらの証明書は、データベースに対する操作を実行するシークレットストアフロントエンドサーバーに格納されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-161">These certificates are stored in the secret store front-end servers that perform operations against the database.</span></span>

### <a name="defense-in-depth"></a><span data-ttu-id="5d557-162">詳細な防御</span><span class="sxs-lookup"><span data-stu-id="5d557-162">Defense-in-depth</span></span>

<span data-ttu-id="5d557-163">Microsoft では、多層防御戦略を使用して、悪意のある俳優が Microsoft クラウドに格納されている顧客データの機密性、整合性、または可用性に影響を与えることを防止しています。</span><span class="sxs-lookup"><span data-stu-id="5d557-163">Microsoft employs a defense-in-depth strategy to prevent malicious actors from impacting the confidentiality, integrity, or availability of customer data stored in the Microsoft Cloud.</span></span> <span data-ttu-id="5d557-164">詳細なセキュリティ戦略の一部として、シークレットストアと可用性キーを保護するために、特定の予防および検出コントロールを実装します。</span><span class="sxs-lookup"><span data-stu-id="5d557-164">Specific preventive and detective controls are implemented to protect the secret store and the availability key as part of the overarching security strategy.</span></span>

<span data-ttu-id="5d557-165">Office 365 は、可用性キーを誤用しないようにビルドされています。</span><span class="sxs-lookup"><span data-stu-id="5d557-165">Office 365 is built to prevent misuse of the availability key.</span></span> <span data-ttu-id="5d557-166">アプリケーション層は、可用性キーを含むキーを使用してデータを暗号化および復号化できる唯一の方法です。</span><span class="sxs-lookup"><span data-stu-id="5d557-166">The application layer is the only method through which keys, including the availability key, can be used to encrypt and decrypt data.</span></span> <span data-ttu-id="5d557-167">Office 365 のサービスコードのみが、暗号化と復号化のアクティビティのキー階層を解釈し、スキャンできます。</span><span class="sxs-lookup"><span data-stu-id="5d557-167">Only Office 365 service code has the ability to interpret and traverse the key hierarchy for encryption and decryption activities.</span></span> <span data-ttu-id="5d557-168">悪意のある Microsoft 管理者が制御を回避して、シークレットストアから可用性キーを抽出しようとした場合、キーは顧客データにアクセスできなくなります。</span><span class="sxs-lookup"><span data-stu-id="5d557-168">If a malicious Microsoft administrator were to circumvent controls to extract an availability key from the secret store, the key would be unusable to access customer data.</span></span> <span data-ttu-id="5d557-169">顧客キー、可用性キー、他の階層キー、および顧客データのストレージの場所の間に論理的な分離が存在します。</span><span class="sxs-lookup"><span data-stu-id="5d557-169">Logical isolation exists between the storage locations of Customer Keys, availability keys, other hierarchical keys, and customer data.</span></span> <span data-ttu-id="5d557-170">この分離により、1つ以上の場所が危険にさらされた場合に、データが危険にさらされるリスクを軽減できます。</span><span class="sxs-lookup"><span data-stu-id="5d557-170">This isolation mitigates the risk of data exposure in the event one or more locations are compromised.</span></span> <span data-ttu-id="5d557-171">階層内の各レイヤーには、24時間365日の侵入検知機能が組み込まれており、データとシークレットストアを保護します。</span><span class="sxs-lookup"><span data-stu-id="5d557-171">Each layer in the hierarchy has built in 24x7 intrusion detection capabilities to protect data and secrets stores.</span></span>

<span data-ttu-id="5d557-172">アクセス制御は、可用性キーシークレットストアなど、内部システムへの権限のないアクセスを防止するために実装されています。</span><span class="sxs-lookup"><span data-stu-id="5d557-172">Access controls are implemented to prevent unauthorized access to internal systems, including availability key secret stores.</span></span> <span data-ttu-id="5d557-173">Microsoft のエンジニアは、可用性キーシークレットストアに直接アクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="5d557-173">Microsoft engineers don't have direct access to the availability key secret stores.</span></span> <span data-ttu-id="5d557-174">アクセス制御の詳細については、「 [Office 365 の管理アクセス制御](https://docs.microsoft.com/Office365/securitycompliance/office-365-administrative-access-controls-overview)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5d557-174">For additional detail on access controls, review [Administrative Access Controls in Office 365](https://docs.microsoft.com/Office365/securitycompliance/office-365-administrative-access-controls-overview).</span></span>

<span data-ttu-id="5d557-175">テクニカルコントロールは、Microsoft の担当者が高度な権限を持つサービスアカウントにログインすることを禁止します。それ以外の場合、攻撃者が Office 365 サービスを偽装するために使用します。</span><span class="sxs-lookup"><span data-stu-id="5d557-175">Technical controls prevent Microsoft personnel from logging into highly-privileged service accounts, which might otherwise be used by attackers to impersonate Office 365 services.</span></span> <span data-ttu-id="5d557-176">たとえば、これらのコントロールは対話型ログオンを防ぎます。</span><span class="sxs-lookup"><span data-stu-id="5d557-176">For example, these controls prevent interactive logon.</span></span>

<span data-ttu-id="5d557-177">セキュリティログおよび監視制御は、Microsoft のサービスとデータに対するリスクを軽減するために実装されたもう1つの多層防御セーフガードです。</span><span class="sxs-lookup"><span data-stu-id="5d557-177">Security logging and monitoring controls are another defense-in-depth safeguard implemented that mitigate risk to Microsoft services and your data.</span></span> <span data-ttu-id="5d557-178">Microsoft サービスチームは、アラートと監査ログを生成するアクティブな監視ソリューションを展開しました。</span><span class="sxs-lookup"><span data-stu-id="5d557-178">Microsoft service teams have deployed active monitoring solutions that generate alerts and audit logs.</span></span> <span data-ttu-id="5d557-179">すべてのサービスチームがログを中央リポジトリにアップロードし、ログを集約して処理します。</span><span class="sxs-lookup"><span data-stu-id="5d557-179">All service teams upload their logs to a central repository where the logs are aggregated and processed.</span></span> <span data-ttu-id="5d557-180">内部ツールは、レコードを自動的に調査して、サービスが最適で回復可能な状態で機能していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="5d557-180">Internal tools automatically examine records to confirm that services are functioning in an optimal, resilient, and secure state.</span></span> <span data-ttu-id="5d557-181">異常なアクティビティについては、さらにレビューを行うようにフラグを付けます。</span><span class="sxs-lookup"><span data-stu-id="5d557-181">Unusual activity is flagged for further review.</span></span>

<span data-ttu-id="5d557-182">マイクロソフトのセキュリティポリシーに違反する可能性があることを示すログイベントは、直ちにマイクロソフトのセキュリティチームを重視しています。</span><span class="sxs-lookup"><span data-stu-id="5d557-182">Any log event that indicates a potential violation of the Microsoft Security Policy is immediately brought to the attention of Microsoft security teams.</span></span> <span data-ttu-id="5d557-183">Office 365 セキュリティでは、可用性キーシークレットストアへのアクセス試行を検出するように警告が構成されています。</span><span class="sxs-lookup"><span data-stu-id="5d557-183">Office 365 security has configured alerts to detect attempted access to availability key secret stores.</span></span> <span data-ttu-id="5d557-184">Microsoft の担当者が、アクセス制御によって禁止および保護されているサービスアカウントへの対話型ログオンを試行する場合も、通知が生成されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-184">Alerts are also generated if Microsoft personnel attempt interactive logon to service accounts, which is prohibited and protected by access controls.</span></span> <span data-ttu-id="5d557-185">Office 365 セキュリティは、通常のベースライン操作から Office 365 サービスの偏差を検出し、警告を出します。</span><span class="sxs-lookup"><span data-stu-id="5d557-185">Office 365 security also detects and alerts upon deviations of the Office 365 service from normal baseline operations.</span></span> <span data-ttu-id="5d557-186">Office 365 サービスを誤用しようとした場合、攻撃者が Microsoft クラウド環境からの削除によって警告を発生させる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="5d557-186">Malefactors attempting to misuse Office 365 services would trigger alerts resulting in the offender's eviction from the Microsoft cloud environment.</span></span>

## <a name="use-the-availability-key-to-recover-from-key-loss"></a><span data-ttu-id="5d557-187">可用性キーを使用してキー損失からの回復を行う</span><span class="sxs-lookup"><span data-stu-id="5d557-187">Use the availability key to recover from key loss</span></span>

<span data-ttu-id="5d557-188">お客様のキーを制御できなくなった場合は、可用性キーを使用して、データを回復して暗号化することができます。</span><span class="sxs-lookup"><span data-stu-id="5d557-188">If you lose control of your Customer Keys, the availability key provides you the ability to recover and re-encrypt your data.</span></span>

### <a name="recovery-procedure-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="5d557-189">Exchange Online と Skype for Business の回復手順</span><span class="sxs-lookup"><span data-stu-id="5d557-189">Recovery procedure for Exchange Online and Skype for Business</span></span>

<span data-ttu-id="5d557-190">顧客キーの制御を失った場合、可用性キーによって、データを回復して、影響を受ける Office 365 リソースをオンラインに戻すことができます。</span><span class="sxs-lookup"><span data-stu-id="5d557-190">If you lose control of your Customer Keys, the availability key gives you the capability to recover your data and bring your impacted Office 365 resources back online.</span></span> <span data-ttu-id="5d557-191">可用性キーは、回復時にデータを保護し続けます。重要な損失から完全に回復するには、高レベルで、新しい DEP を作成し、影響を受けるリソースを新しいポリシーに移行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5d557-191">The availability key continues to protect your data while you recover.At a high level, to fully recover from key loss, you'll need to create a new DEP and move impacted resources to the new policy.</span></span>

<span data-ttu-id="5d557-192">新しい顧客キーを使用してデータを暗号化するには、Azure Key Vault で新しいキーを作成し、新しい顧客キーを使用して新しい DEP を作成した後、以前の DEP で暗号化されたキーが失われたか漏洩したメールボックスに新しい DEP を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="5d557-192">To encrypt your data with new Customer Keys, create new keys in Azure Key Vault, create a new DEP using the new Customer Keys, then assign the new DEP to the mailboxes currently encrypted with the previous DEP for which the keys were lost or compromised.</span></span>

<span data-ttu-id="5d557-193">この再暗号化プロセスには、最大72時間かかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="5d557-193">This re-encryption process can take up to 72 hours.</span></span> <span data-ttu-id="5d557-194">これは、DEP を変更するときの標準的な期間です。</span><span class="sxs-lookup"><span data-stu-id="5d557-194">This is the standard duration when you change a DEP.</span></span>
  
### <a name="recovery-procedure-for-sharepointonlineonedriveforbusinessandteamsfiles"></a><span data-ttu-id="5d557-195">SharePoint Online、OneDrive for Business、および Teams ファイルの回復手順</span><span class="sxs-lookup"><span data-stu-id="5d557-195">Recovery procedure for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="5d557-196">SharePoint Online、OneDrive for Business、Teams ファイルでは、可用性キーが回復機能の外部で使用されることはありません。</span><span class="sxs-lookup"><span data-stu-id="5d557-196">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability.</span></span> <span data-ttu-id="5d557-197">回復シナリオで可用性キーの使用を開始するように、Microsoft に明示的に指示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5d557-197">You must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span> <span data-ttu-id="5d557-198">回復プロセスを開始するには、Microsoft に連絡して可用性キーを有効にします。</span><span class="sxs-lookup"><span data-stu-id="5d557-198">To initiate the recovery process, contact Microsoft to activate the availability key.</span></span> <span data-ttu-id="5d557-199">有効にすると、可用性キーが自動的に使用され、新しい顧客キーに関連付けられた新しく作成された DEP を使用してデータを暗号化することができます。</span><span class="sxs-lookup"><span data-stu-id="5d557-199">Once activated, the availability key is automatically used to decrypt your data allowing you to encrypt the data with a newly-created DEP associated to new Customer Keys.</span></span>  

<span data-ttu-id="5d557-200">この操作は、組織内のサイト数に比例します。</span><span class="sxs-lookup"><span data-stu-id="5d557-200">This operation is proportional to the number of sites in your organization.</span></span> <span data-ttu-id="5d557-201">Microsoft に連絡して可用性キーを使用すると、約4時間以内に完全にオンラインになります。</span><span class="sxs-lookup"><span data-stu-id="5d557-201">Once you call Microsoft to use the availability key, you should be fully online within about four hours.</span></span>

## <a name="how-exchange-online-and-skype-for-business-use-the-availability-key"></a><span data-ttu-id="5d557-202">Exchange Online と Skype for Business が可用性キーを使用する方法</span><span class="sxs-lookup"><span data-stu-id="5d557-202">How Exchange Online and Skype for Business use the availability key</span></span>

<span data-ttu-id="5d557-203">顧客キーを使用して DEP を作成すると、Office 365 はその DEP に関連付けられているデータ暗号化ポリシーキー (DEP キー) を生成します。</span><span class="sxs-lookup"><span data-stu-id="5d557-203">When you create a DEP with Customer Key, Office 365 generates a Data Encryption Policy Key (DEP Key) associated with that DEP.</span></span> <span data-ttu-id="5d557-204">このサービスは、DEP キーを3回暗号化します。1回は各顧客キーで、もう1回は可用性キーを使用しています。</span><span class="sxs-lookup"><span data-stu-id="5d557-204">The service encrypts the DEP Key three times: once with each of the customer keys and once with the availability key.</span></span> <span data-ttu-id="5d557-205">暗号化されたバージョンの DEP キーのみが保存され、DEP キーは顧客キーまたは可用性キーを使用してのみ復号化できます。</span><span class="sxs-lookup"><span data-stu-id="5d557-205">Only the encrypted versions of the DEP Key are stored, and a DEP Key can only be decrypted with the customer keys or the availability key.</span></span> <span data-ttu-id="5d557-206">次に、DEP キーを使用して、個々のメールボックスを暗号化するメールボックスキーを暗号化します。</span><span class="sxs-lookup"><span data-stu-id="5d557-206">The DEP Key is then used to encrypt Mailbox Keys, which encrypt individual mailboxes.</span></span>
  
<span data-ttu-id="5d557-207">Office 365 は、次のプロセスに従って、顧客がサービスを使用しているときにデータの暗号化を解除し、提供します。</span><span class="sxs-lookup"><span data-stu-id="5d557-207">Office 365 follows this process to decrypt and provide data when customers are using the service:</span></span>
  
1. <span data-ttu-id="5d557-208">顧客キーを使用して DEP キーを復号化します。</span><span class="sxs-lookup"><span data-stu-id="5d557-208">Decrypt the DEP Key using the Customer Key.</span></span>

2. <span data-ttu-id="5d557-209">暗号化されていない DEP キーを使用して、メールボックスキーを復号化します。</span><span class="sxs-lookup"><span data-stu-id="5d557-209">Use the decrypted DEP Key to decrypt a Mailbox Key.</span></span>

3. <span data-ttu-id="5d557-210">復号化されたメールボックスキーを使用して、メールボックス自体の暗号化を解除し、メールボックス内のデータにアクセスできるようにします。</span><span class="sxs-lookup"><span data-stu-id="5d557-210">Use the decrypted Mailbox Key to decrypt the mailbox itself, allowing you to access the data within the mailbox.</span></span>

<span data-ttu-id="5d557-211">Office 365 は、わずかなオフセットで Azure Key Vault に2つの復号化要求を発行することによって、DEP キーを復号化します。</span><span class="sxs-lookup"><span data-stu-id="5d557-211">Office 365 decrypts a DEP Key by issuing two decryption requests to Azure Key Vault with a slight offset.</span></span> <span data-ttu-id="5d557-212">最初の furnishes が完了し、その他の要求を取り消します。</span><span class="sxs-lookup"><span data-stu-id="5d557-212">The first one to finish furnishes the result, canceling the other request.</span></span>

## <a name="how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key"></a><span data-ttu-id="5d557-213">SharePoint Online、OneDrive for Business、および Teams のファイルが可用性キーを使用する方法</span><span class="sxs-lookup"><span data-stu-id="5d557-213">How SharePoint Online, OneDrive for Business, and Teams files use the availability key</span></span>

<span data-ttu-id="5d557-214">SharePoint Online および OneDrive for Business のアーキテクチャと、顧客キーと可用性キーの実装は、Exchange Online と Skype for business とは異なります。</span><span class="sxs-lookup"><span data-stu-id="5d557-214">The SharePoint Online and OneDrive for Business architecture and implementation for Customer Key and availability key are different from Exchange Online and Skype for Business.</span></span>
  
<span data-ttu-id="5d557-215">組織が顧客が管理するキーに移行すると、Office 365 はテナント固有の中間キー (TIK) を作成します。</span><span class="sxs-lookup"><span data-stu-id="5d557-215">When an organization moves to customer-managed keys, Office 365 creates a tenant-specific intermediate key (TIK).</span></span> <span data-ttu-id="5d557-216">Office 365 は、各顧客キーを使用して、TIK を2回暗号化し、TIK の2つの暗号化されたバージョンを格納します。</span><span class="sxs-lookup"><span data-stu-id="5d557-216">Office 365 encrypts the TIK twice, once with each of the customer keys, and stores the two encrypted versions of the TIK.</span></span> <span data-ttu-id="5d557-217">TIK の暗号化バージョンのみが保存され、TIK は顧客キーでのみ復号化できます。</span><span class="sxs-lookup"><span data-stu-id="5d557-217">Only the encrypted versions of the TIK are stored, and a TIK can only be decrypted with the customer keys.</span></span> <span data-ttu-id="5d557-218">次に、TIK は、サイトキーを暗号化するために使用され、次に blob キー (ファイルチャンクキーとも呼ばれる) を暗号化するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-218">The TIK is then used to encrypt site keys, which are then used to encrypt blob keys (also called file chunk keys).</span></span> <span data-ttu-id="5d557-219">ファイルサイズに応じて、1つのファイルを一意のキーを持つ複数のファイルチャンクに分割することができます。</span><span class="sxs-lookup"><span data-stu-id="5d557-219">Depending on file size, the service may split a file into multiple file chunks each with a unique key.</span></span> <span data-ttu-id="5d557-220">Blob (ファイルチャンク) 自体は、blob キーを使用して暗号化され、Microsoft Azure Blob ストレージサービスに格納されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-220">The blobs (file chunks) themselves are encrypted with the blob keys and stored in the Microsoft Azure Blob storage service.</span></span>
  
<span data-ttu-id="5d557-221">Office 365 は、顧客がサービスを使用しているときに顧客ファイルを復号化し、提供するために、このプロセスに従います。</span><span class="sxs-lookup"><span data-stu-id="5d557-221">Office 365 follows this process to decrypt and provide customer files when customers are using the service:</span></span>

1. <span data-ttu-id="5d557-222">顧客キーを使用して、TIK を復号化します。</span><span class="sxs-lookup"><span data-stu-id="5d557-222">Decrypt the TIK using the Customer Key.</span></span>

2. <span data-ttu-id="5d557-223">復号化された TIK を使用して、サイトキーを復号化します。</span><span class="sxs-lookup"><span data-stu-id="5d557-223">Use the decrypted TIK to decrypt a site key.</span></span>

3. <span data-ttu-id="5d557-224">復号化されたサイトキーを使用して、blob キーを復号化します。</span><span class="sxs-lookup"><span data-stu-id="5d557-224">Use the decrypted site key to decrypt a blob key.</span></span>

4. <span data-ttu-id="5d557-225">復号化された blob キーを使用して、blob の暗号化を解除します。</span><span class="sxs-lookup"><span data-stu-id="5d557-225">Use the decrypted blob key to decrypt the blob.</span></span>

<span data-ttu-id="5d557-226">Office 365 は、わずかなオフセットで Azure Key Vault に2つの復号化要求を発行することによって、TIK を復号化します。</span><span class="sxs-lookup"><span data-stu-id="5d557-226">Office 365 decrypts a TIK by issuing two decryption requests to Azure Key Vault with a slight offset.</span></span> <span data-ttu-id="5d557-227">最初の furnishes が完了し、その他の要求を取り消します。</span><span class="sxs-lookup"><span data-stu-id="5d557-227">The first one to finish furnishes the result, canceling the other request.</span></span>
  
<span data-ttu-id="5d557-228">顧客キーへのアクセスが失われた場合、Office 365 は、使用可能キーを使用して TIK を暗号化し、これを、各顧客キーで暗号化された Tik と共に格納します。</span><span class="sxs-lookup"><span data-stu-id="5d557-228">In case you lose access to your customer keys, Office 365 also encrypts the TIK with an availability key and stores this along with the TIKs encrypted with each customer key.</span></span> <span data-ttu-id="5d557-229">可用性キーで暗号化された TIK は、お客様が Microsoft を呼び出して、キーにアクセスできなくなったときに、故意または誤って回復パスを登録する場合にのみ使用されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-229">The TIK encrypted with the availability key is used only when the customer calls Microsoft to enlist the recovery path when they have lost access to their keys, maliciously or accidentally.</span></span>
  
<span data-ttu-id="5d557-230">可用性とスケールの理由から、復号化された TIKs は時間限定メモリキャッシュにキャッシュされます。</span><span class="sxs-lookup"><span data-stu-id="5d557-230">For availability and scale reasons, decrypted TIKs are cached in a time-limited memory cache.</span></span> <span data-ttu-id="5d557-231">TIK キャッシュを期限切れに設定する2時間前に、Office 365 は各 TIK の暗号化を解除しようとします。</span><span class="sxs-lookup"><span data-stu-id="5d557-231">Two hours before a TIK cache is set to expire, Office 365 attempts to decrypt each TIK.</span></span> <span data-ttu-id="5d557-232">TIKs を復号化すると、キャッシュの有効期間が延長されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-232">Decrypting the TIKs extends the lifetime of the cache.</span></span> <span data-ttu-id="5d557-233">TIK 復号化が長時間に失敗すると、Office 365 はキャッシュの有効期限が切れる前にエンジニアリングに通知する警告を生成します。</span><span class="sxs-lookup"><span data-stu-id="5d557-233">If TIK decryption fails for a significant amount of time, Office 365 generates an alert to notify engineering prior to the cache expiration.</span></span> <span data-ttu-id="5d557-234">お客様が Microsoft を呼び出している場合にのみ、Office 365 が回復操作を開始します。これには、Microsoft のシークレットストアに格納されている可用性キーを使用して TIK の暗号化を解除し、暗号化された TIK と新しいセットのセットを使用して、もう一度テナントをオンにします。ユーザーが指定した Azure Key Vault キー。</span><span class="sxs-lookup"><span data-stu-id="5d557-234">Only if the customer calls Microsoft will Office 365 initiate the recovery operation, which involves decrypting the TIK with the availability key stored in Microsoft's secret store and onboarding the tenant again using the decrypted TIK and a new set of customer-supplied Azure Key Vault keys.</span></span>
  
<span data-ttu-id="5d557-235">現時点では、顧客キーは Azure blob ストアに保存されている SharePoint Online ファイルデータの暗号化と復号化チェーンに関係していますが、SQL データベースに格納されている SharePoint Online のリストアイテムまたはメタデータは含まれていません。</span><span class="sxs-lookup"><span data-stu-id="5d557-235">As of today, Customer Key is involved in the encryption and decryption chain of SharePoint Online file data stored in the Azure blob store, but not SharePoint Online list items or metadata stored in the SQL Database.</span></span> <span data-ttu-id="5d557-236">Office 365 では、Exchange Online、Skype for Business、SharePoint Online、OneDrive for Business、および上記のケース以外の Teams ファイル (お客様が開始) に対して可用性キーは使用されません。</span><span class="sxs-lookup"><span data-stu-id="5d557-236">Office 365 does not use the availability key for Exchange Online, Skype for Business, SharePoint Online, OneDrive for Business, and Teams files other than the case described above, which is customer-initiated.</span></span> <span data-ttu-id="5d557-237">お客様のデータへのアクセスは、顧客のロックボックスで保護されています。</span><span class="sxs-lookup"><span data-stu-id="5d557-237">Human access to customer data is protected by Customer Lockbox.</span></span>

## <a name="availability-key-triggers"></a><span data-ttu-id="5d557-238">可用性キートリガー</span><span class="sxs-lookup"><span data-stu-id="5d557-238">Availability key triggers</span></span>

<span data-ttu-id="5d557-239">Office 365 は、特定の状況でのみ可用性キーをトリガーします。</span><span class="sxs-lookup"><span data-stu-id="5d557-239">Office 365 triggers the availability key only in specific circumstances.</span></span> <span data-ttu-id="5d557-240">これらの環境はサービスによって異なります。</span><span class="sxs-lookup"><span data-stu-id="5d557-240">These circumstances differ by service.</span></span>

### <a name="triggers-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="5d557-241">Exchange Online と Skype for Business のトリガー</span><span class="sxs-lookup"><span data-stu-id="5d557-241">Triggers for Exchange Online and Skype for Business</span></span>
  
1. <span data-ttu-id="5d557-242">Office 365 は、Azure Key Vault で2つの顧客キーの場所を決定するために、メールボックスが割り当てられている DEP を読み取ります。</span><span class="sxs-lookup"><span data-stu-id="5d557-242">Office 365 reads the DEP to which the mailbox is assigned in order to determine the location of the two Customer Keys in Azure Key Vault.</span></span>

2. <span data-ttu-id="5d557-243">Office 365 は、DEP から2つの顧客キーのいずれかをランダムに選択し、顧客キーを使用して DEP キーの折り返しを解除するために、Azure Key Vault に要求を送信します。</span><span class="sxs-lookup"><span data-stu-id="5d557-243">Office 365 randomly chooses one of the two Customer Keys from the DEP and sends a request to Azure Key Vault to unwrap the DEP key using the Customer Key.</span></span>

3. <span data-ttu-id="5d557-244">顧客キーを使用して DEP キーのラップを解除する要求が失敗した場合、Office 365 は2番目の要求を Azure Key Vault に送信します。このとき、代替 (2 番目の) 顧客キーを使用するように指示します。</span><span class="sxs-lookup"><span data-stu-id="5d557-244">If the request to unwrap the DEP key using the Customer Key fails, Office 365 sends a second request to Azure Key Vault, this time instructing it to use the alternate (second) Customer Key.</span></span>

4. <span data-ttu-id="5d557-245">顧客キーを使用して DEP キーの折り返しを解除する2番目の要求が失敗した場合、Office 365 は両方の要求の結果を調べます。</span><span class="sxs-lookup"><span data-stu-id="5d557-245">If the second request to unwrap the DEP key using the Customer Key fails, Office 365 examines the results of both requests.</span></span>

    - <span data-ttu-id="5d557-246">検証で、要求がシステムエラーを返して失敗したことが判断された場合:</span><span class="sxs-lookup"><span data-stu-id="5d557-246">If the examination determines that the requests failed returning a system ERROR:</span></span>

       - <span data-ttu-id="5d557-247">Office 365 は、可用性キーをトリガーして DEP キーを復号化します。</span><span class="sxs-lookup"><span data-stu-id="5d557-247">Office 365 triggers the availability key to decrypt the DEP key.</span></span>

       - <span data-ttu-id="5d557-248">Office 365 は、DEP キーを使用してメールボックスキーを復号化し、ユーザー要求を完了します。</span><span class="sxs-lookup"><span data-stu-id="5d557-248">Office 365 then uses the DEP key to decrypt the mailbox key and complete the user request.</span></span> 

       - <span data-ttu-id="5d557-249">この場合、Azure Key Vault は一時的なエラーのために応答できないか、到達不能になります。</span><span class="sxs-lookup"><span data-stu-id="5d557-249">In this case, Azure Key Vault is either unable to respond or unreachable due to a transient ERROR.</span></span>

    - <span data-ttu-id="5d557-250">検証で、要求がアクセス拒否を返して失敗したことが判断された場合:</span><span class="sxs-lookup"><span data-stu-id="5d557-250">If the examination determines that the requests failed returning ACCESS DENIED:</span></span>

       - <span data-ttu-id="5d557-251">そのため、意図的、不注意、または悪意のあるアクションが実行され、顧客キーが使用できなくなります (たとえば、サービスを終了する一環として、データの削除処理中)。</span><span class="sxs-lookup"><span data-stu-id="5d557-251">This means deliberate, inadvertent, or malicious action has been taken to render the customer keys unavailable (for example, during the data purge process as part of leaving the service).</span></span>

       - <span data-ttu-id="5d557-252">この場合、可用性キーは使用されず、ユーザー要求は失敗し、ユーザーはエラーメッセージを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="5d557-252">In this case, the availability key will not be used, the user request fails, and the user receives an error message.</span></span>

>[!IMPORTANT]
><span data-ttu-id="5d557-253">Office 365 サービスコードでは、顧客データを理由として、付加価値のあるクラウドサービスを提供するための有効なログイントークンが常に用意されています。</span><span class="sxs-lookup"><span data-stu-id="5d557-253">Office 365 service code always has a valid login token for reasoning over customer data to provide value-adding cloud services.</span></span> <span data-ttu-id="5d557-254">そのため、可用性キーが削除されるまでは、検索インデックスの作成やメールボックスの移動など、Exchange Online と Skype for Business で開始される操作または内部からのアクションのフォールバックとして使用できます。</span><span class="sxs-lookup"><span data-stu-id="5d557-254">Therefore, until the availability key has been deleted, it can be used as a fallback for actions initiated by, or internal to, Exchange Online and Skype for Business such as search index creation or moving mailboxes.</span></span> <span data-ttu-id="5d557-255">これは、一時的なエラーと、Azure Key Vault へのアクセス拒否要求の両方に適用されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-255">This applies to both transient ERRORS and ACCESS DENIED requests to Azure Key Vault.</span></span>

### <a name="triggers-for-sharepoint-online-onedrive-for-business-and-teams-files"></a><span data-ttu-id="5d557-256">SharePoint Online、OneDrive for Business、Teams ファイルのトリガー</span><span class="sxs-lookup"><span data-stu-id="5d557-256">Triggers for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="5d557-257">SharePoint Online、OneDrive for Business、Teams ファイルでは、可用性キーは復旧機能の外部では使用されず、お客様は、復旧シナリオで可用性キーの使用を開始するように明示的に指示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5d557-257">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability and customers must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span>

## <a name="audit-logs-and-the-availability-key"></a><span data-ttu-id="5d557-258">監査ログと可用性キー</span><span class="sxs-lookup"><span data-stu-id="5d557-258">Audit logs and the availability key</span></span>

<span data-ttu-id="5d557-259">Office 365 の自動化されたシステムは、ウイルス対策、電子情報開示、データ損失防止、データのインデックス作成など、クラウドサービスを提供するために、すべてのデータをシステム内でフローして処理します。</span><span class="sxs-lookup"><span data-stu-id="5d557-259">Automated systems in Office 365 process all data as it flows through the system to provide cloud services, for example, anti-virus, e-discovery, data loss prevention, and data indexing.</span></span> <span data-ttu-id="5d557-260">Office 365 は、このアクティビティのお客様に表示されるログを生成しません。</span><span class="sxs-lookup"><span data-stu-id="5d557-260">Office 365 does not generate customer-visible logs for this activity.</span></span> <span data-ttu-id="5d557-261">また、Microsoft の担当者は、このような通常のシステム操作の一部としてデータにアクセスすることはありません。</span><span class="sxs-lookup"><span data-stu-id="5d557-261">In addition, Microsoft personnel do not access your data as part of these normal system operations.</span></span>

### <a name="exchange-online-and-skype-for-business-availability-key-logging"></a><span data-ttu-id="5d557-262">Exchange Online と Skype for Business の可用性キーのログ</span><span class="sxs-lookup"><span data-stu-id="5d557-262">Exchange Online and Skype for Business availability key logging</span></span>

<span data-ttu-id="5d557-263">Exchange Online と Skype for Business では、一時的なエラーが発生したときに可用性キーが自動的に使用されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-263">Exchange Online and Skype for Business automatically use the availability key during transient errors.</span></span> <span data-ttu-id="5d557-264">このフォールバックが発生すると、Office 365 は、セキュリティ/コンプライアンスセンターからアクセス可能な顧客の表示ログを公開します。</span><span class="sxs-lookup"><span data-stu-id="5d557-264">When this fallback occurs, Office 365 publishes customer-visible logs accessible from the Security and Compliance Center.</span></span> <span data-ttu-id="5d557-265">可用性キー操作の監査ログレコードは、これらのサービスが可用性キーを使用するたびに生成されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-265">An audit log record for the availability key operation is generated each time these services use the availability key.</span></span> <span data-ttu-id="5d557-266">アクティビティの種類が "フォールバックツー可用性キー" の新しいレコードの種類として、管理者が[統合監査ログ](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance)の検索結果をフィルター処理して可用性キーレコードを表示することができます。</span><span class="sxs-lookup"><span data-stu-id="5d557-266">A new record type called “Customer Key Service Encryption” with activity type "Fallback to Availability Key" allows admins to filter [Unified Audit Log](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance) search results to view availability key records.</span></span> <span data-ttu-id="5d557-267">Availability キーレコードは、顧客キーがデータへのアクセスに使用されている場合にのみ生成され、Microsoft のサービス管理キーに対しては生成されません。</span><span class="sxs-lookup"><span data-stu-id="5d557-267">The availability key record gets generated only when Customer Key is used to access the data and not for Microsoft service-managed keys.</span></span>

<span data-ttu-id="5d557-268">ログレコードには、日付、時刻、アクティビティ、組織 ID、データ暗号化ポリシー ID などの属性が含まれます。</span><span class="sxs-lookup"><span data-stu-id="5d557-268">Log records include attributes such as date, time, activity, organization ID, and data encryption policy ID.</span></span> <span data-ttu-id="5d557-269">レコードは Office 365 の統合監査ログの一部として利用でき、Office 365 の [セキュリティとコンプライアンスセンターの監査ログの検索] タブからアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="5d557-269">The record is available as part of Office 365 Unified Audit Logs and is accessible from the Office 365 Security and Compliance Center Audit Log Search tab.</span></span>

![可用性キーイベントの監査ログ検索](media/customerkeyauditlogsearchavailabilitykeyloggingimage.png)

<span data-ttu-id="5d557-271">Exchange Online と Skype for Business の可用性キーレコードは、Office 365 Management Activity [common schema](https://docs.microsoft.com/office/office-365-management-api/office-365-management-activity-api-schema#common-schema)を追加のカスタムパラメーターと共に使用します。ポリシー Id、範囲キーバージョン Id、および要求 Id。</span><span class="sxs-lookup"><span data-stu-id="5d557-271">Exchange Online and Skype for Business availability key records use the Office 365 Management Activity [common schema](https://docs.microsoft.com/office/office-365-management-api/office-365-management-activity-api-schema#common-schema) with added custom parameters: Policy Id, Scope Key Version Id, and Request Id.</span></span>

![可用性キーのカスタムパラメーター](media/customerkeyauditlogsearchavailabilitykeyloggingcustomparam.png)

### <a name="sharepoint-online-onedrive-for-business-and-teams-files-availability-key-logging"></a><span data-ttu-id="5d557-273">SharePoint Online、OneDrive for Business、および Teams ファイル可用性キーのログ</span><span class="sxs-lookup"><span data-stu-id="5d557-273">SharePoint Online, OneDrive for Business, and Teams files availability key logging</span></span>

<span data-ttu-id="5d557-274">可用性キーのログ記録は、これらのサービスではまだ利用できません。</span><span class="sxs-lookup"><span data-stu-id="5d557-274">Availability key logging isn't available yet for these services.</span></span> <span data-ttu-id="5d557-275">SharePoint Online、OneDrive for Business、Teams ファイルでは、可用性キーは Microsoft によって指示された場合にのみ、回復目的でライセンス認証されます。</span><span class="sxs-lookup"><span data-stu-id="5d557-275">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is only activated by Microsoft, when instructed by you, for recovery purposes.</span></span> <span data-ttu-id="5d557-276">その結果、これらのサービスに対して可用性キーが使用されるすべてのイベントが既にわかっています。</span><span class="sxs-lookup"><span data-stu-id="5d557-276">As a result, you already know every event in which the availability key is used for these services.</span></span>

## <a name="availability-key-in-the-customer-key-hierarchy"></a><span data-ttu-id="5d557-277">顧客キー階層の可用性キー</span><span class="sxs-lookup"><span data-stu-id="5d557-277">Availability key in the Customer Key hierarchy</span></span>
  
<span data-ttu-id="5d557-278">Office 365 は、可用性キーを使用して、カスタマーキーサービス暗号化に対して確立されたキー階層の下位レベルのキーをラップします。</span><span class="sxs-lookup"><span data-stu-id="5d557-278">Office 365 uses the availability key to wrap the tier of keys lower in the key hierarchy established for Customer Key service encryption.</span></span> <span data-ttu-id="5d557-279">サービス間には異なるキー階層が存在します。</span><span class="sxs-lookup"><span data-stu-id="5d557-279">Different key hierarchies exist between services.</span></span> <span data-ttu-id="5d557-280">キーアルゴリズムは、適用可能な各サービスの階層内の可用性キーとその他のキーによっても異なります。</span><span class="sxs-lookup"><span data-stu-id="5d557-280">Key algorithms also differ between availability keys and other keys in the hierarchy of each applicable service.</span></span> <span data-ttu-id="5d557-281">さまざまなサービスで使用される可用性キーアルゴリズムは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="5d557-281">The availability key algorithms used by the different services are as follows:</span></span>

- <span data-ttu-id="5d557-282">Exchange Online と Skype for Business の可用性キーは、AES-256 を使用します。</span><span class="sxs-lookup"><span data-stu-id="5d557-282">The Exchange Online and Skype for Business availability keys use AES-256.</span></span>

- <span data-ttu-id="5d557-283">SharePoint Online、OneDrive for Business、および Teams ファイルの可用性キーは RSA-2048 を使用します。</span><span class="sxs-lookup"><span data-stu-id="5d557-283">The SharePoint Online, OneDrive for Business, and Teams files availability keys use RSA-2048.</span></span>

### <a name="encryption-ciphers-used-to-encrypt-keys-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="5d557-284">Exchange Online と Skype for Business のキーを暗号化するために使用される暗号化暗号</span><span class="sxs-lookup"><span data-stu-id="5d557-284">Encryption ciphers used to encrypt keys for Exchange Online and Skype for Business</span></span>

![Exchange Online の顧客キーの暗号化暗号](media/customerkeyencryptionhierarchiesexchangeskype.png)

### <a name="encryption-ciphers-used-to-encrypt-keys-for-sharepoint-online-and-onedrive-for-business"></a><span data-ttu-id="5d557-286">SharePoint Online と OneDrive for business のキーを暗号化するために使用される暗号化暗号</span><span class="sxs-lookup"><span data-stu-id="5d557-286">Encryption ciphers used to encrypt keys for SharePoint Online and OneDrive for Business</span></span>

![SharePoint Online の顧客キーの暗号化暗号](media/customerkeyencryptionhierarchiessharepointonedriveteamsfiles.png)

## <a name="related-articles"></a><span data-ttu-id="5d557-288">関連記事</span><span class="sxs-lookup"><span data-stu-id="5d557-288">Related articles</span></span>

- [<span data-ttu-id="5d557-289">Office 365 の顧客キーによるサービスの暗号化</span><span class="sxs-lookup"><span data-stu-id="5d557-289">Service encryption with Customer Key for Office 365</span></span>](customer-key-overview.md)

- [<span data-ttu-id="5d557-290">Office 365 の顧客キーを設定する</span><span class="sxs-lookup"><span data-stu-id="5d557-290">Set up Customer Key for Office 365</span></span>](customer-key-set-up.md)

- [<span data-ttu-id="5d557-291">Office 用の顧客キーの管理365</span><span class="sxs-lookup"><span data-stu-id="5d557-291">Manage Customer Key for Office 365</span></span>](customer-key-manage.md)

- [<span data-ttu-id="5d557-292">顧客キーまたは可用性キーをロールまたは回転する</span><span class="sxs-lookup"><span data-stu-id="5d557-292">Roll or rotate a Customer Key or an availability key</span></span>](customer-key-availability-key-roll.md)
