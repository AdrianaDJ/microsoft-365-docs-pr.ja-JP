---
title: セキュリティ/コンプライアンス センター のメッセージ追跡
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
audience: ITPro
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
ms.assetid: 3e64f99d-ac33-4aba-91c5-9cb4ca476803
ms.custom:
- seo-marvel-apr2020
description: 管理者は、セキュリティ コンプライアンス センターのメッセージ追跡&、メッセージがどうなったかを見つけ出します。
ms.openlocfilehash: c6e1f8f9280c84ab6ff6a1572d902ed1d4d4caa3
ms.sourcegitcommit: e12fa502bc216f6083ef5666f693a04bb727d4df
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/20/2020
ms.locfileid: "46827053"
---
# <a name="message-trace-in-the-security--compliance-center"></a>セキュリティ/コンプライアンス センター のメッセージ追跡

## <a name="message-trace-features"></a>メッセージ追跡機能

コンプライアンス センターのメッセージ追跡は&Exchange Online 組織を通過する電子メール メッセージをたみります。 メッセージがサービスによって受信、拒否、延期、配信されたかどうかを確認できます。 メッセージが最終的な状態になる前に、メッセージに行われた処理も表示します。

コンプライアンス センターのメッセージ追跡&、Exchange 管理センター (EAC) で利用できる元のメッセージ追跡に関して、機能が強化されています。 メッセージ追跡から情報を使用して、メッセージに対する変更点に関するユーザーの質問に効率的に回答し、メール フローの問題をトラブルシューティングし、ポリシーの変更を検証することができます。

> [!NOTE]
>
> - メッセージトレースを行うには、組織管理、コンプライアンス管理、またはヘルプ デスクの役割グループのメンバーである必要があります。 詳細については、「[セキュリティ/コンプライアンス センターのアクセス許可](permissions-in-the-security-and-compliance-center.md)」を参照してください。
>
> - 結果に表示されるメッセージの最大数は、選択したレポートの種類によって異なります (詳細については、「 [レポートの種類を選択する」セクション](#choose-report-type) を参照してください)。 Exchange Online PowerShell [の Get-HistoricalSearch](https://docs.microsoft.com/powershell/module/exchange/get-historicalsearch) コマンドレットまたはスタンドアロン EOP PowerShell は、すべてのメッセージを結果で返します。

## <a name="open-message-trace"></a>メッセージ追跡を開く

1. [監視] & [インストール] を開きます <https://protection.office.com> 。

2. メール **フローを展開し**、[メッセージ追跡] **を選択します**。

## <a name="message-trace-page"></a>メッセージ追跡ページ

ここから、[トレースの開始] ボタンをクリックして新しい既定 **のトレースを開始** できます。 これにより、過去 2 日間のすべての送信者と受信者のすべてのメッセージが検索されます。 または、利用可能なクエリ カテゴリの保存されたクエリを使用してそのクエリをその他で実行するか、独自のクエリの開始点として使用します。

- **既定のクエリ**: Microsoft 365 によって提供される組み込みのクエリ。

- **カスタム クエリ**: 将来使用できるように組織の管理者によって保存されたクエリ。

- **オート保存されたクエリ**: 最後に実行されたクエリを最後に 10 回。 この一覧では、前の箇下の位置から簡単に切り替えることができます。

また、このページは **提出した要求** 、およびダウンロード可能な場合はレポートを説明するダウンロードレポート セクションから構成されます。

## <a name="options-for-a-new-message-trace"></a>新しいメッセージ追跡用のオプション

### <a name="filter-by-senders-and-recipients"></a>送信者と受信者でフィルター処理

既定値は All **senders と All** recipients **ですが**、次のフィールドを使用して結果をフィルター処理できます。

- **ユーザー別:** このフィールドをクリックして、組織から 1 人または複数の送信者を選択します。 また、検索ページの機能と同様に、名前の入力を始めにして、リスト内のアイテムを入力した内容によってフィルター処理されます。

- **これらのユーザーに対**して: このフィールドをクリックして、組織内の 1 人または複数の受信者を選択します。

> [!NOTE]
> また、外部の送信者と受信者の電子メール アドレスを入力することもできます。 ワイルドカードがサポートされていますが (たとえば `*@contoso.com` 、)同じフィールドに同時に複数のワイルドカード エントリを使用することはできません。 <br/><br/> 複数の送信者または受信者一覧をセミコロン ( ) で区切って貼り付ける場合 `;` 。 スペース ( ) `\s` の値、キャリッジ リゲージン ( `\r` ) または次の行 ( ) `\n` を返します。

### <a name="time-range"></a>時間範囲

既定値は **2 日です**が、最大 90 日間の日付/時間の範囲を指定できます。 日付/時刻の範囲を使用する場合は、次の問題を考慮してください。

- 既定では、タイムラインを使用してスラ **イダー ビュー** の時間範囲を選択します。 表示された日付または時刻の設定のみを選択できます。 間の値を選択しようとすると、表示される設定の末尾にスナップします。

  ![セキュリティ センター内の新しいメッセージ追跡のスライダーの&時間範囲](../../media/55a9e9c1-f7d5-4047-b217-824e8b976bcb.png)

  カスタム ビューに切り替**えると、[開始**日] と [**End date****終了**日] の値 (時刻を含む) を指定できます。また、日付/時刻の範囲として**タイム**ゾーンを選択することもできます。 タイム ゾーン設定 **は、** クエリ入力とクエリ結果の両方に適用されます。

  ![セキュリティ センター のセキュリティ センターの新しいメッセージ追跡のカスタム &時間範囲](../../media/ed4c8d50-9ea5-4694-93f9-ee3ab6660b4f.png)

  10 日以内の場合は、結果を概要レポートとして即時 **に利用** できます。 10 日を少し遅く指定した場合、結果はダウンロード可能な CSV **ファイル** (拡張概要レポートまたは拡張レポート) としてのみ利用可能なため **、遅延** されます。

  別のレポートの種類の詳細については、このトピックの「 [レポートの種類を選択する](#choose-report-type) 」セクションを参照してください。

  **注**: 拡張された概要レポートおよび拡張レポートは、アーカイブされたメッセージ追跡データを使用して準備されるもので、レポートがダウンロード可能になるまでに数時間かかる場合があります。 他の管理者が同時にレポート要求を送信したことによっては、キューに登録された要求の処理が開始されるまで時間が長くなることがあります。

- スライダー **ビューにクエリを** 保存すると、相対的な時間範囲 (たとえば、現在から 3 日) を節約できます。 カスタム ビューにクエリ **を保存** すると、絶対日付/時刻範囲 (たとえば、2018-05-06 13:00 ~ 2018-05-08 18:00) を保存します。

### <a name="more-search-options"></a>その他の検索オプション

#### <a name="delivery-status"></a>配信状態

既定値 [All] は選択 **された** ままにするか、次のいずれかの値を選択して結果をフィルター処理できます。

- **配信済**み: メッセージは目的の宛先に正常に配信されました。

- **保留**中: メッセージの配信を試行または再試行しています。

- **[展開済**み]: 配布グループの受信者が展開され、その後グループの個々のメンバーに配信されました。

- **失敗**: メッセージは配信されませんでした。

- **検疫**済み: メッセージは検疫されました (スパム、バルク メール、フィッシングとして)。 詳細については [、EOP の検疫済み電子メール メッセージを参照してください](quarantine-email-messages.md)。

- **スパムとしてフィルター処理**しました。メッセージはスパムと特定され、拒否またはブロックされた (検疫されなかった) されました。

- **状態の取得:** メッセージは Microsoft 365 によって最近受信されたが、その他の状態データはまだ利用できません。 数分後にチェックインしてください。

**注**: スパムとして**Pending、Quarantined、Filter****Pending,****の値を使用**できるのは、10 日未満です。 また、実際の配信状態と報告された配信状態の間に 5 分から 10 分の遅延が生じることがあります。

#### <a name="message-id"></a>メッセージ ID

これは、メッセージ ヘッダーの **Message-ID:** ヘッダー フィールドに含まれているインターネット メッセージ ID (クライアント ID とも呼ばれる) です。 ユーザーからこの値が返って、特定のメッセージを調査できます。

この値は、メッセージの有効期間全体にわたって不変です。 Microsoft 365 または Exchange で作成されたメッセージの場合、値は角かっこ ( ) を含む `<GUID@ServerFQDN>` 形式になります \< \> 。 たとえば、`<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>` などです。 他のメッセージング システムは異なる構文や値を使用します。 この値は一意であると見なされますが、すべてのメール システムがこの要件を実際に従う必要はありません。 **Message-ID: ヘッダー フィールドが**存在しないか、外部ソースからの受信メッセージ用に空白の場合は任意の値が割り当てられます。

メッセージ ID を **使用して結果** をフィルター処理する場合は、角かっこを含む完全な文字列を含める必要があります。

#### <a name="direction"></a>Direction

既定値 [All] **は選択した** ままにするか、[ **受信** ] (組織内の受信者に送信されたメッセージ) または **[送信** ] (組織内のユーザーから送信されたメッセージ) を選択して結果をフィルター処理できます。

#### <a name="original-client-ip-address"></a>元のクライアント IP アドレス

大量のスパムまたはマルウェアを送信しているハッキングされたコンピューターを調査するために、クライアント IP アドレスごとに結果をエクスポートできます。 メッセージは複数の送信者から送信されたように見えるかもしねませんが、同じコンピューターがすべてのメッセージを生成している可能性があります。

**注**: クライアント IP アドレス情報は 10 日間のみ利用可能で、拡張概要**レポートまたは拡張**レポート (ダウンロード可能な CSV ファイル) でのみ利用できます。 **Extended**

### <a name="choose-report-type"></a>レポートの種類を選

使用できるレポートの種類は次のとおりです。

- **概要**: 時間範囲が 10 日未満で、追加のフィルター処理オプションは必要ありません。 結果は、[検索] をクリックした直後に表示 **されます**。 このレポートで返される結果の最大数は 20000 です。

- **拡張概要**または**拡張**: これらのレポートはダウンロード可能な CSV ファイルとしてのみ利用可能で、時間範囲にかかわらず次のフィルター オプションの 1 つ以上が**必要です**。**これらの**ユーザーは、これらのユーザー、**これらの**ユーザー、またはメッセージ ID 。 送信者または受信者にワイルドカードを使用できます (たとえば \* 、@contoso.com)。 拡張概要レポートは、最大 50000 の結果を返します。 拡張レポートは最大 1000 の結果を返します。

**注**:

- 拡張された概要レポートと拡張レポートは、アーカイブ済みメッセージの追跡データを使用して準備されます。レポートがダウンロード可能になるまでに数時間かかる場合があります。 他の管理者が同時にレポート要求を送信した場合、キューに入れ済み要求の処理が開始されるまでに遅延が発生する場合があります。

- 日付/時刻の範囲に関する拡張概要レポートまたは拡張レポートを選択できますが、一般に、アーカイブされたデータの過去 4 時間は、これら 2 種類のレポートではまだ利用できません。

[ **次へ] をクリック**すると、選択したフィルター オプション、レポートの一意の (編集可能な) タイトル、メッセージの追跡が完了した (また、編集可能で、組織の承認済みドメインのいずれかに入れる) に表示される通知を受け取る電子メール アドレスが表示されます。 [ **レポートの準備] を** クリックして、メッセージ追跡を送信します。 メイン メッセージ追跡 **ページでは** 、ダウンロード可能なレポート セクションにレポートの **状態が表示** されます。

さまざまなレポートの種類で返される詳細については、次のセクションを参照してください。

## <a name="message-trace-results"></a>メッセージ追跡の結果

レポートの種類が異なると、さまざまなレベルの情報が返されます。 次のセクションでは、各レポートで使用可能な情報について説明します。

### <a name="summary-report-output"></a>概要レポートの出力

メッセージ追跡を実行した後、結果がリスト表示され、昇順に並べ替えることができます (最新のもの順)。

![セキュリティ グループ ポリシー コンプライアンス センターでのメッセージ追跡の&結果](../../media/0664bafe-0b03-477b-b571-0b046ac8c977.png)

概要レポートには以下の情報が含まれます。

- **日付**: 構成済みの UTC タイム ゾーンを使用して、サービスがメッセージを受信した日時。

- **Sender:** 送信者の電子メール アドレス (*alias* @ *ドメイン*)。

- **Recipient:** 受信者の電子メール アドレス。 複数の受信者に送信されるメッセージの場合は、受信者ごとに 1 行に割り当てます。 受信者が配布グループ、動的配布グループ、またはメールが有効なセキュリティ グループである場合、グループが最初の受信者になり、そのグループの各メンバーが別個の行に作成されます。

- **Subject**: メッセージの件名フィールドの最初の 256 **文字** 。

- **Status:** これらの値は、「配信の状態」 [セクションに記述](#delivery-status) されています。

既定では、最初の 250 の結果が読み込まれ、使用可能です。 スクロールダウンすると、次の結果のバッチが読み込まれるので、少し一時停止します。 スクロールではなく、[すべて読み込む] を **クリック** すると、すべての結果を最大 10,000 まで読み込むことができます。

列見出しをクリックすると、その列の値の昇順または下昇順で結果を並べ替えることができます。

[結果をフィルター **処理] をクリック** すると、1 つまたは複数の列で結果をフィルター処理できます。

[エクスポート結果] をクリックし、[**すべての**結果のエクスポート]、読み込まれた結果のエクスポート、または [**選択**したエクスポート] を選択**して**、1 行または複数行を選び、**結果をエクスポートできます**。

#### <a name="find-related-records-for-this-message"></a>このメッセージの関連レコードを検索する

関連するメッセージ レコードは、同じメッセージ ID を共有するレコードです。 2 人のユーザー間で送信されたメッセージが 1 つであっても、複数のレコードが生成される場合があります。 メッセージが配布グループの拡張、転送、メール フロー ルール (トランスポート ルールとも呼ばれる) などの影響を受けると、レコードの数が増加します。

行のチェック ボックスをオンにした後、表示される [**関連**情報] ボタンをクリックするか、このメッセージに関連するその他の**More options**オプションを選択して、メッセージの関連 ![ ](../../media/1ea52bbf-9d00-48ce-9362-307f7f6fb7fe.png) \> **するレコードを見つけ出します**。

メッセージ ID の詳細については、前述のメッセージ ID のセクションを参照してください。

#### <a name="message-trace-details"></a>メッセージ追跡の詳細

概要レポートの出力では、次のいずれかの方法を使用してメッセージに関する詳細を表示できます。

- 行を選択します (チェック ボックス以外の行の任意の場所をクリックします)。

- 行のチェック ボックスをオンにし、[その他のオプションの **表示]** ![ ](../../media/1ea52bbf-9d00-48ce-9362-307f7f6fb7fe.png) \> **をクリックします**。

   ![概要レポート メッセージの追跡結果の行をダブルクリックした後の詳細は、セキュリティ/コンプライアンス &詳細](../../media/e50ee7cd-810a-4c06-8b58-e56ffd7028d1.png)

メッセージ追跡の詳細には、概要レポートにない次の追加情報が含まれています。

- **メッセージ イベント**: このセクションには、サービスがメッセージに対して実行するアクションの分類に役立つ分類が含まれています。 **発生する可能性のあるイベントの一** 部を次に示します。

  - **受信**: メッセージはサービスによって受信された。

  - **Send:** メッセージがサービスによって送信された。

  - **Fail:** メッセージ配信に失敗しました。

  - **配信**: メッセージはメールボックスに配信されました。

  - **Expand**: 展開された配布グループにメッセージが送信されました。

  - **転送**: コンテンツ変換、メッセージの受信者制限、またはエージェントが原因で、エラーが発生したメッセージに受信者が移動されました。

  - **Defer**: メッセージ配信が延期され、後で再試行される可能性があります。

  - **Resolved**: メッセージは Active Directory 検索に基づいて受信者のアドレスにリダイレクトされました。 このイベントが発生した場合、メッセージ トレースの別の行に、メッセージの最終配信状態と併せて、元の受信者のアドレスが表示されます。

  注:

  - メッセージ追跡では、イベント処理が成功したメッセージが複数の **イベント** エントリを生成します。

  - この一覧は、まだ使用できないことを目的としていません。 詳細なイベントの説明については、メッセージ追跡 [ログのイベントの種類を参照してください](https://docs.microsoft.com/Exchange/mail-flow/transport-logs/message-tracking#event-types-in-the-message-tracking-log)。 このリンクは、(Exchange Serverオンプレミスの Exchange) トピックであるためです。

- **詳細:** このセクションには、以下の詳細情報が含まれています。

  - **メッセージ ID**: この値については、このトピック [で前述したメッセージ ID](#message-id) に関するセクションで説明しています。 たとえば、`<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>` などです。

  - **メッセージ サイズ**   添付ファイルを含むキロバイト (KB) 単位のメッセージのサイズ。

  - **From IP:** The IP address of the computer that sent the message. Exchange Online から送信された送信メッセージの場合、この値は空白です。

  - **IP:** サービスがメッセージを配信しようとした IP アドレス。 メッセージに複数の受信者が含される場合は、次の受信者が表示されます。 Exchange Online に送信された受信メッセージの場合、この値は空白です。

### <a name="enhanced-summary-reports"></a>拡張概要レポート

選択したメッセージ追跡の開始レポート セクションには、拡張 **された概要レポート** が含まれています。 このレポートでは次の情報を使用できます。

- **origin_timestamp:** <sup>*</sup> 構成済みの UTC タイム ゾーンを使用して、サービスがメッセージを最初に受信した日時。

- **sender_address**: 送信者の電子メール アドレス ( エイリア*ス* @ *ドメイン*)。

- **Recipient_status:** 受信者へのメッセージの配信状態です。 メッセージが複数の受信者に送信された場合は、すべての受信者と対応する状態が次の形式で \<*email address*\> 表示されます。 ## \<*status*\> たとえば、次のようにします。

  - **##Receive、送信** は、メッセージがサービスによって受信され、指定された宛先に送信されたことを意味します。

  - **##Receive Fail は** メッセージがサービスによって受信されたが、指定された宛先に配信できないことを意味します。

  - **##Receive は、** メッセージがサービスによって受信され、受信者のメールボックスに配信されたことを意味します。

- **message_subject:** メッセージの [件名] フィールドの最初の 256 **文字** 。

- **total_bytes:** 添付ファイルを含むバイト単位のメッセージのサイズ。

- **message_id**: この値は、このトピック [で前述したメッセージ ID](#message-id) に関するセクションで説明されています。 たとえば、`<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>` などです。

- **network_message_id:** メッセージのすべてのコピーで分割や配布グループの展開により作成される可能性がある一意のメッセージ ID。 値の例は `1341ac7b13fb42ab4d4408cf7f55890f` .

- **original_client_ip:** 送信者のクライアントの IP アドレス。

- **directionality:** メッセージが組織への受信 (1) か、組織からの送信 (2) メッセージであるかを示します。

- **connector_id:** 送信元コネクタまたは送信先コネクタの名前です。 Exchange Online のコネクタの詳細については、「Exchange Online の [コネクタを使ったメール フローの構成」Officeしてください](https://docs.microsoft.com/Exchange/mail-flow-best-practices/use-connectors-to-configure-mail-flow/use-connectors-to-configure-mail-flow)。

- **delivery_priority:** <sup>*</sup> メッセージが送信された情報が高**Low**、**低**、または標準優先度の**どうか**。

<sup>*</sup>これらのプロパティは、拡張された概要レポートでのみ使用できます。

### <a name="extended-reports"></a>拡張レポート

拡張レポートは、メッセージ追跡の開始 **時点でダウンロード可能** なレポート セクションで確認できます。 拡張概要レポートのすべての情報は **(origin_timestamp** および delivery_priority ) を例外として拡張レポート **で使用できます**。 以下の追加情報は拡張レポートでのみ使用できます。

- **client_ip:** メッセージを送信した電子メール サーバーまたはメッセージング クライアントの IP アドレス。

- **client_hostname:** メッセージを送信した電子メール サーバーまたはメッセージング クライアントのホスト名または FQDN です。

- **server_ip:** 送信元サーバーまたは送信先サーバーの IP アドレスです。

- **server_hostname:** 送信先サーバーのホスト名または FQDN。

- **source_context**: ソース フィールドに関連付 **けられている追加情報** です。 たとえば、次のようにします。

  - `Protocol Filter Agent`

  - `3489061114359050000`

- **ソース**:イベントを処理する Exchange Online コンポーネント。 たとえば、次のようにします。

  - `AGENT`

  - `MAILBOXRULE`

  - `SMTP`

- **event_id**: These correspond to the **Message event** values that are explained in the Find related records for [this message](#find-related-records-for-this-message) section.

- **internal_message_id:** 現在メッセージを処理している Exchange Online サーバーによって割り当てられたメッセージ識別子。

- **recipient_address:** メッセージ受信者の電子メール アドレス。 複数の電子メール アドレスがある場合は、セミコロン (;) で区切られます。

- **recipient_count:** メッセージ内の受信者の合計数。

- **related_recipient_address**: " `EXPAND` " で `REDIRECT` 、、および `RESOLVE` イベントと共に使用され、メッセージに関連付けられている他の受信者の電子メール アドレスを表示します。

- **reference:** このフィールドには、特定の種類のイベントについての追加情報が含まれます。 たとえば、次のようにします。

  - **DSN:** レポート リンクが含まれます。これは、この **イベントの後** に DSN が生成された場合に、関連する配信状態通知 (DSN、配信不能レポート、NDR、またはバウンス メッセージとも呼ばれる) の message_id 値です。 これが DSN メッセージの場合、このフィールドには、DSN **message_id** 生成された元のメッセージの値が含まれます。

  - **EXPAND**: 関連 **メッセージrelated_recipient_address** の値が含まれます。

  - **Receive**:他の **プロセスによってmessage_id** によって生成された場合、関連するメッセージの受信トレイ値を含む RECEIVE 。受信トレイ ルールなどがあります。

  - **SEND:** すべての DSN **internal_message_id** の値を含む。

  - **TRANSFER:****会議internal_message_id**されているメッセージの値 (たとえば、コンテンツ変換、メッセージの受信者の制限、エージェント単位) が格納されます。

  - **MAILBOXRULE:****受信internal_message_id**生成メッセージを生成する原因となってき、受信メッセージの値が含まれます。

    その他の種類のイベントの場合、このフィールドは通常空白です。

- **return_path:** メッセージを送信した MAIL FROM コマンドで **指定された** リターン電子メール アドレス。 このフィールドが空であることはありませんが、空の送信者アドレス値が表されている場合があります `<>` 。

- **message_info:** メッセージに関する追加情報です。 たとえば、次のようにします。

  - メッセージの発生日時 (UTC とイベント `DELIVER` の日時 `SEND` )。 発生日時は、そのメッセージが最初に Exchange Online 組織に入力した日時です。 UTC の日付と時刻は、ISO 8601 の日付と時刻形式で表されます。 `yyyy-mm-ddThh:mm:ss.fffZ` ここで `yyyy` 、= year, `mm` = month, = day は時間コンポーネントの開始を示 `dd` `T` し `hh` 、= 時間 `mm` 、= 分 `ss` 、= 秒、 `fff` 秒の `Z` `Zulu` 小数部、およびその 2 つ目の区切り文字 。UTC を指定する別の方法です。

  - 認証エラー。 たとえば、認証エラーが発生すると `11a` 、使用された認証の種類と種類が表示されます。

- **tenant_id**: Exchange Online 組織を表す GUID 値です (例 `39238e87-b5ab-4ef6-a559-af54c6b07b42` :

- **original_server_ip**: 元のサーバーの IP アドレス。

- **custom_data**: 特定のイベントの種類に関連するデータが格納されています。 詳細については、以下のセクションを参照してください。

#### <a name="custom_data-values"></a>custom_data値

イベント **custom_data** フィールドは `AGENTINFO` 、さまざまな Exchange Online エージェントによってメッセージ処理の詳細を記録するために使用されます。 一般的に役に示すいくつかのエージェントについては、以下のセクションで説明します。

#### <a name="spam-filter-agent"></a>スパム フィルター エージェント

最初 **custom_data** の値は `S:SFA` 、スパム フィルター エージェントの値です。 キーの詳細を次の表に示します。

****

|値|説明|
|---|---|
|`SFV=NSPM`|メッセージがスパムではないとしてマークされ、意図された受信者に送信されました。|
|`SFV=SPM`|メッセージは、スパム対策フィルター (コンテンツ フィルターとも呼ばれる) によってスパムとしてマークされました。|
|`SFV=BLK`|ブロックする差出人から発信されたメッセージであるため、フィルター処理が省略され、メッセージはブロックされました。|
|`SFV=SKS`|スパム対策フィルター処理の処理前に、メッセージがスパムとしてマークされました。 これには、メッセージを自動的にスパムメールとしてマークし、他のすべてのフィルター処理を省略するトランスポート ルールに一致するメッセージが含まれます。|
|`SCL=<number>`|さまざまな SCL の値とその意味の詳細については、「[Spam Confidence Level](spam-confidence-levels.md)」を参照してください。|
|`PCL=<number>`|メッセージの Phishing Confidence Level (PCL) 値。これらの値は、「[Spam Confidence Level](spam-confidence-levels.md)」に記載されている SCL 値と同様に解釈できます。  |
|`DI=SB`|メッセージの送信者はブロックされました。|
|`DI=SQ`|メッセージは検疫されました。|
|`DI=SD`|メッセージは削除されました。|
|`DI=SJ`|メッセージは受信者の迷惑メール フォルダーに送信されました。|
|`DI=SN`|メッセージは通常の送信用の配信プールを通じて送信されました。|
|`DI=SO`|メッセージがより危険度の高い配信プールを経由してルーティングされました。 詳細については、「[送信メッセージにおける危険度の高い配信プール](high-risk-delivery-pool-for-outbound-messages.md)」を参照してください。|
|`SFS=[a]|SFS=[b]`|これはスパム ルールが一致したことを示します。|
|`IPV=CAL`|このメッセージの IP アドレスは接続フィルターの IP 許可一覧に指定されているため、スパム フィルターの通過を許可されました。|
|`H=<EHLOstring>`|接続メール サーバーの HELO または EHLO 文字列。|
|`PTR=<ReverseDNS>`|送信元の IP アドレスの PTR レコード (逆引き DNS アドレスともいう) です。|
|

スパムに **custom_data** されたメッセージの値の例を次に示します。

`S:SFA=SUM|SFV=SPM|IPV=CAL|SRV=BULK|SFS=470454002|SFS=349001|SCL=9|SCORE=-1|LIST=0|DI=SN|RD=ftmail.inc.com|H=ftmail.inc.com|CIP=98.129.140.74|SFP=1501|ASF=1|CTRY=US|CLTCTRY=|LANG=en|LAT=287|LAT=260|LAT=18;`

#### <a name="malware-filter-agent"></a>マルウェア フィルター エージェント

マルウェア **custom_data** 基始値 `S:AMA` の取得が通用です。 キーの詳細を次の表に示します。

****

|値|説明|
|---|---|
|`AMA=SUM|v=1|` または `AMA=EV|v=1`|このメッセージは、マルウェアが含まれていると判断されました。 `SUM` は、マルウェアがいくつでも検出された可能性を示します。 `EV` は、特定のエンジンによってマルウェアが検出されたことを示します。 エンジンでマルウェアが検出された場合は、後続のアクションをトリガーします。|
|`Action=r`|メッセージは置き換えられました。|
|`Action=p`|メッセージはバイパスされました。|
|`Action=d`|メッセージは延期されました。|
|`Action=s`|メッセージは削除されました。|
|`Action=st`|メッセージはバイパスされました。|
|`Action=sy`|メッセージはバイパスされました。|
|`Action=ni`|メッセージは拒否されました。|
|`Action=ne`|メッセージは拒否されました。|
|`Action=b`|メッセージはブロックされました。|
|`Name=<malware>`|検出されたマルウェアの名前。|
|`File=<filename>`|マルウェアを含むファイルの名前。|
|

マルウェアを **custom_data** を含むメッセージの値の例は、次のようになります。

`S:AMA=SUM|v=1|action=b|error=|atch=1;S:AMA=EV|engine=M|v=1|sig=1.155.974.0|name=DOS/Test_File|file=filename;S:AMA=EV|engine=A|v=1|sig=201707282038|name=Test_File|file=filename`

#### <a name="transport-rule-agent"></a>トランスポート ルール エージェント

メール **custom_data** ルール (トランスポート ルール `S:TRA` とも呼ばれる) のトランスポート ルール エージェントから始めつ役割の値です。 キーの詳細を次の表に示します。

****

|値|説明|
|---|---|
|`ETR|ruleId=<guid>`|一致したルールの ID。|
|`St=<datetime>`|ルールの一致が発生した日時 (UTC)。|
|`Action=<ActionDefinition>`|適用されたアクション。 使用可能なアクションの一覧については、「Exchange Online 内 [」の「メール フロー ルールのアクション」を参照してください](https://docs.microsoft.com/exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)。|
|`Mode=<Mode>`|ルールのモード。 有効な値は次のとおりです。<ul><li>**Enforce**: All actions on the rule will be enforced.</li><li>**ポリシー ヒントありのテスト:** ポリシー ヒント アクションが送信されますが、他の強制アクションは実行されません。</li><li>**ポリシー ヒントなしのテスト**: アクションはログ ファイルにリストされますが、送信者には通知されず、強制アクションは実行されません。</li></ul>|
|

メール **フロー custom_data** 条件に一致するメッセージの値の例は、次のようになります。

`S:TRA=ETR|ruleId=19a25eb2-3e43-4896-ad9e-47b6c359779d|st=7/17/2017 12:31:25 AM|action=ApplyHtmlDisclaimer|sev=1|mode=Enforce`
