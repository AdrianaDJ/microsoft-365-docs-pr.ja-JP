---
title: マルウェア対策ポリシーを構成する
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: b0cfc21f-e3c6-41b6-8670-feb2b2e252e5
ms.collection:
- M365-security-compliance
description: 管理者は、Office 365 でマルウェア対策ポリシーを構成する方法について説明します。
ms.openlocfilehash: 26770f192e5e7c116032d73e7abaa184305faa96
ms.sourcegitcommit: 9224a7a5886c0c5fa0bc12bd9f7234a0eba90023
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/02/2020
ms.locfileid: "42372095"
---
# <a name="configure-anti-malware-policies-in-office-365"></a>Office 365 でマルウェア対策ポリシーを構成する

Exchange Online または exchange online メールボックスを持たないスタンドアロンの Exchange Online Protection (EOP) 顧客のメールボックスを使用している Office 365 顧客の場合、電子メールメッセージは EOP によってマルウェアから自動的に保護されます。 EOP は、マルウェア保護設定に対してマルウェア対策ポリシーを使用します。 詳細については、「[マルウェア対策保護](anti-malware-protection.md)」を参照してください。

管理者は、既定のマルウェア対策ポリシーを表示、編集、および構成 (削除することはできません) して、組織のニーズを満たすことができます。 よりきめ細かく制御する場合は、組織内の特定のユーザー、グループ、またはドメインに適用するカスタムのマルウェア対策ポリシーを作成することもできます。 カスタムポリシーは、常に既定のポリシーより優先されますが、カスタムポリシーの優先度 (実行順序) を変更することもできます。

マルウェア対策ポリシーを構成するには、Office 365 Security & コンプライアンスセンターまたは PowerShell (Office 365 お客様の場合は Exchange Online PowerShell) を使用します。Exchange Online Protection PowerShell (スタンドアロン EOP のお客様向け)。

## <a name="what-do-you-need-to-know-before-you-begin"></a>始める前に把握しておくべき情報

- セキュリティ & コンプライアンスセンターに<https://protection.office.com/>表示されます。

- Exchange Online PowerShell へ接続するには、「[Exchange Online PowerShell に接続する](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell)」を参照してください。 Exchange Online Protection PowerShell に接続するには、「 [Exchange Online protection の powershell への接続](https://docs.microsoft.com/powershell/exchange/exchange-eop/connect-to-exchange-online-protection-powershell)」を参照してください。

- これらの手順を実行する前に、アクセス許可を割り当てる必要があります。 マルウェア対策ポリシーを追加、変更、および削除するには、**組織の管理**または**セキュリティ管理者**の役割グループのメンバーである必要があります。 マルウェア対策ポリシーへの読み取り専用アクセスには、**セキュリティリーダー**役割グループのメンバーである必要があります。 セキュリティ & コンプライアンスセンターの役割グループの詳細については、「 [Office 365 セキュリティ & コンプライアンスセンターのアクセス許可](permissions-in-the-security-and-compliance-center.md)」を参照してください。

## <a name="use-the-security--compliance-center-to-create-anti-malware-policies"></a>セキュリティ & コンプライアンスセンターを使用してマルウェア対策ポリシーを作成する

セキュリティ & コンプライアンスセンターでカスタムマルウェア対策ポリシーを作成すると、両方に同じ名前を使用して、マルウェアフィルタールールと関連するマルウェアフィルターポリシーが同時に作成されます。

1. セキュリティ & コンプライアンスセンターで、[**脅威管理** \> **ポリシー** \>**マルウェア対策**] に移動し、[**新規** ![追加]](../../media/ITPro-EAC-AddIcon.png)アイコンをクリックします。

2. [**新しいマルウェア対策ポリシー** ] ページが開いたら、次の設定を構成します。

   - [**名前**]: わかりやすい一意のポリシー名を入力します。

   - **説明**: ポリシーの説明 (オプション) を入力します。

   - [**マルウェア検出応答**]: [**受信者にメッセージが検疫された場合に通知する方法]** の値のいずれかを選択します。設定:

     - **No**: メッセージは、目的の受信者への通知なしで検疫されます。 これは既定の値です。

     - **はい、既定の通知テキストを使用**します。メッセージは検疫されます。 メッセージのコピーは受信者に配信されますが、検出されたものだけでなく、*すべて*の添付ファイルは、既定のテキストを含む、**マルウェアの警告テキスト**という名前の1つのテキストファイルに置き換えられます。 既定のテキストについては、「[マルウェア対策ポリシー](anti-malware-protection.md#anti-malware-policies)」を参照してください。

     - **はい、カスタム通知テキストを使用**します。メッセージは検疫されます。 メッセージのコピーは受信者に配信されますが、検出されたものだけでなく、*すべて*の添付ファイルは、**マルウェアの警告テキスト**という名前の1つのテキストファイルに置き換えられます。 txt には、[**カスタム警告テキスト**] ボックスに指定したユーザー設定のテキストが含まれています。

   - [**一般的な添付ファイルの種類のフィルター**]:**コンピューターに問題を起こす可能性のある添付ファイルの種類をブロックする**ために、次のいずれかの値を選択します。

     - **オフ**

     - **On**: 指定された添付ファイルを持つメッセージはマルウェアの検出として扱われ、自動的に検疫されます。 [**追加**] および [**削除**] ボタンをクリックして、リスト bu を変更することができます。

   - [**マルウェアのゼロ時間自動削除**]:**ポリシーのアクションを自動的に実行して、配信後にマルウェアが検出されたメッセージを検疫することにより、ユーザーを保護**するためにこれらの値のいずれかを選択します。

     - **オフ**

     - **オン (推奨)**

   - **通知**: このセクションの設定は、メッセージ内でマルウェアが検出されたときの送信者と管理者の通知を制御します。

     - **送信者の通知**: 次のオプションのどちらか一方または両方を選択します。

       - **内部**送信者に通知する: 内部送信者が組織内にある。

       - **外部**の送信者に通知: 外部の送信者は組織の外部にあります。

     - **管理者の通知**: 次のオプションのどちらか一方または両方を選択します。

       - [**内部送信者からの未配信メッセージについて管理者に通知**する]: このオプションを選択する場合は、[**管理者の電子メールアドレス**] ボックスに通知電子メールアドレスを入力します。

       - [**外部送信者からの未配信メッセージについて管理者に通知**する]: このオプションを選択する場合は、[**管理者の電子メールアドレス**] ボックスに通知電子メールアドレスを入力します。

     - **通知のカスタマイズ**: これらの設定は、送信者または管理者に対して使用される既定の通知テキストに置き換えられます。 既定値の詳細については、「[マルウェア対策ポリシー](anti-malware-protection.md#anti-malware-policies)」を参照してください。

       - **カスタマイズした通知テキストを使用**する: このオプションを選択する場合は、[差出人の**名前**] ボックスと [差出人の**アドレス**] ボックスを使用して、カスタマイズした通知メッセージで使用される送信者の名前と電子メールアドレスを指定する必要があります。

       - **内部送信者からのメッセージ**: 内部送信者からの配信不能メッセージについて送信者または管理者に通知することを選択した場合、[**件名**] ボックスと [**メッセージ**] ボックスを使用して、カスタム通知メッセージの件名とメッセージ本文を指定する必要があります。

       - **外部送信者からのメッセージ**: 外部送信者からの配信不能メッセージについて送信者または管理者に通知することを選択した場合、[**件名**] ボックスと [**メッセージ**] ボックスを使用して、カスタム通知メッセージの件名とメッセージ本文を指定する必要があります。

   - **適用対象**: このセクションの設定は、ポリシーが適用される内部の受信者を識別します。

     - 次の**場合**: [ **1 つ選択**] ドロップダウンをクリックして、ルールの条件を選択します。

       - **受信者は**次のとおりです。組織内で1つ以上のメールボックス、メールユーザー、またはメール連絡先を指定します。 表示される [**メンバーの選択**] ダイアログボックスで、一覧から1人以上の受信者を選択し、[**追加\>**] をクリックします。 [**名前の確認**] ボックスでは、複数の電子メールアドレスに対してワイルド\*カードを使用できます (例: @fabrikam .com)。 完了したら、 **[OK]** をクリックします。

       - **受信者のドメイン**: Office 365 で構成された1つ以上の承認済みドメインの受信者を指定します。 表示されるダイアログボックスで、1つ以上のドメインを選択し、[**追加\>**] をクリックします。 完了したら、 **[OK]** をクリックします。

       - **受信者が次のメンバーの**場合: 組織内の1つまたは複数のグループを指定します。 表示される [**メンバーの選択**] ダイアログボックスで、一覧から1つ以上のグループを選択し、[**追加\>**] をクリックします。 完了したら、 **[OK]** をクリックします。

     条件は1回だけ使用できますが、条件に複数の値を指定することができます。 同じ条件の複数の値を使用するか、ロジックを指定します (たとえば、 _ \<recipient1\> _または_ \<recipient2\>_)。 さまざまな条件とロジック ( _ \<recipient1\> _ 、 _ \<グループ\>1 のメンバー_など) を使用します。 さらに条件を追加するには、**[条件の追加]** をクリックして、リストから残りのオプションを選択します。

     - 次の**場合を除き**、ルールの例外を追加するには、[**例外の追加**] をクリックし、[ **1 つ選択**] ドロップダウンをクリックして、例外を構成します。 設定と動作は条件とまったく同じです。

3. 完了したら、**[保存]** をクリックします。

## <a name="use-the-security--compliance-center-to-view-anti-malware-policies"></a>セキュリティ & コンプライアンスセンターを使用してマルウェア対策ポリシーを表示する

1. [セキュリティ & コンプライアンスセンター] で、[**脅威管理** \> **ポリシー** \>の**マルウェア対策**] に移動します。

2. ポリシーを選択すると、そのポリシーに関する情報が詳細ウィンドウに表示されます。 ポリシーに関する詳細情報を表示するには **、[edit** ![edit icon](../../media/ITPro-EAC-EditIcon.png)] をクリックします。

   - **[有効]** プロパティの値、**[優先度]** プロパティの値、および **[適用先]** タブの設定が、マルウェア フィルター ルールに含まれます。

   - **[全般]** タブと **[設定]** タブの設定が、マルウェア フィルター ポリシーに含まれます。

## <a name="use-the-security--compliance-center-to-modify-anti-malware-policies"></a>セキュリティ & コンプライアンスセンターを使用してマルウェア対策ポリシーを変更する

1. [セキュリティ & コンプライアンスセンター] で、[**脅威管理** \> **ポリシー** \>の**マルウェア対策**] に移動します。

2. ポリシーを選択し、[編集**** ![アイコン](../../media/ITPro-EAC-EditIcon.png)の編集] をクリックします。 設定の詳細については、このトピックの「[セキュリティ & コンプライアンスセンターを使用してマルウェア対策ポリシーを作成する](#use-the-security--compliance-center-to-create-anti-malware-policies)」セクションを参照してください。

   **注**:

   - 設定は、すべてが 1 つのページに配置されているのではなく、**[全般]** タブ、**[設定]** タブ、および **[適用先]** タブに分けられています。 [**適用先**] タブは、default (すべてのユーザーに自動的に適用されます) という名前の既定のポリシーでは使用できません。

   - 既定のポリシーの名前は変更できません。

## <a name="use-the-security--compliance-center-to-enable-or-disable-anti-malware-policies"></a>セキュリティ & コンプライアンスセンターを使用してマルウェア対策ポリシーを有効または無効にする

1. [セキュリティ & コンプライアンスセンター] で、[**脅威管理** \> **ポリシー** \>の**マルウェア対策**] に移動します。

2. リストからポリシーを選択して、次に示すいずれかの設定を構成します。

   - **ポリシーを無効にする**: [**有効**] 列のチェックボックスをオフにします。 既定では、セキュリティ & コンプライアンスセンターでマルウェア対策ポリシーを作成すると有効になります。

   - **ポリシーを有効**にします。 [**有効**] 列のチェックボックスをオンにします。

## <a name="use-the-security--compliance-center-to-set-the-priority-of-custom-anti-malware-policies"></a>セキュリティ & コンプライアンスセンターを使用して、カスタムマルウェア対策ポリシーの優先度を設定する

既定では、マルウェア対策ポリシーには、作成された順序に基づく優先度が与えられます (新しいポリシーは、以前のポリシーよりも優先度が低いです)。 優先度番号が小さいほど、ポリシーの優先度が高くなることを意味します (優先度の高いポリシーは、優先度の低いポリシーよりも前に処理されます)。 2 つのポリシーに同じ優先度を設定することはできません。

 **注**:

- セキュリティ & コンプライアンスセンターでは、マルウェア対策ポリシーの作成後に優先度を変更することしかできません。 PowerShell では、マルウェアフィルタールールを作成するときに既定の優先順位を上書きできます (既存のルールの優先度に影響する場合があります)。

- セキュリティ & コンプライアンスセンターでは、マルウェア対策ポリシーが表示される順序で処理されます (最初のポリシーの**優先度**値は0です)。 Default という名前の既定のマルウェア対策ポリシーの優先度の値は**最低**で、これを変更することはできません。

ポリシーの優先度を変更するには、リスト内でポリシーを上下に移動します (セキュリティ & コンプライアンスセンターで**優先度**番号を直接変更することはできません)。

1. [セキュリティ & コンプライアンスセンター] で、[**脅威管理** \> **ポリシー** \>の**マルウェア対策**] に移動します。

2. ポリシーを選択し、[上上へ**移動** ![] アイコン](../../media/ITPro-EAC-UpArrowIcon.png)をクリック**するか** ![、下](../../media/ITPro-EAC-DownArrowIcon.png)矢印アイコンを下に移動して、リスト内でルールを上下に移動します。

## <a name="use-the-security--compliance-center-to-remove-anti-malware-policies"></a>セキュリティ & コンプライアンスセンターを使用してマルウェア対策ポリシーを削除する

セキュリティ & コンプライアンスセンターを使用してマルウェア対策ポリシーを削除すると、マルウェアフィルタールールとそれに対応するマルウェアフィルターポリシーの両方が削除されます。

1. [セキュリティ & コンプライアンスセンター] で、[**脅威管理** \> **ポリシー** \>の**マルウェア対策**] に移動します。

2. 一覧から削除するマルウェア対策ポリシーを選択し、[削除] **[削除]** ![アイコン](../../media/ITPro-EAC-DeleteIcon.png)をクリックします。

## <a name="use-exchange-online-powershell-or-exchange-online-protection-powershell-to-configure-anti-malware-policies"></a>Exchange Online PowerShell または Exchange Online Protection PowerShell を使用してマルウェア対策ポリシーを構成する

### <a name="use-powershell-to-create-anti-malware-policies"></a>PowerShell を使用してマルウェア対策ポリシーを作成する

PowerShell でマルウェア対策ポリシーを作成するには、次の2つの手順を実行します。

1. マルウェア フィルター ポリシーを作成する。

2. マルウェア フィルター ルールを作成する (ルールの適用先のマルウェア フィルター ポリシーを指定します)。

 **注**:

- 新しいマルウェアフィルタールールを作成し、それに対する既存の関連付けられていないマルウェアフィルターポリシーを割り当てることができます。 1つのマルウェアフィルタールールを複数のマルウェアフィルターポリシーに関連付けることはできません。

- ポリシーを作成するまでは、セキュリティ & コンプライアンスセンターでは使用できない、PowerShell の新しいマルウェア対策ポリシーで構成できる2つの設定があります。

  - 新しいポリシーを無効として作成します ( **new-malwarefilterpolicy**コマンドレットでは_有効_ `$false` )。

  - **New-malwarefilterrule**コマンドレットで、作成中にポリシーの優先度を設定します (_優先度_ _ \<番号\>_)。

- この結果は、マルウェアフィルターポリシーをマルウェアフィルタールールに割り当てるまで、セキュリティ & コンプライアンスセンターに表示されません。

#### <a name="step-1-use-powershell-to-create-a-malware-filter-policy"></a>手順 1: PowerShell を使用してマルウェアフィルターポリシーを作成する

**注**:_アクション_パラメーターの値_DeleteMessage_、 _deleteattachmentandusedefaultalert_、および_DeleteAttachmentAndUseCustomAlert_は、クラウドベースのサービス内のメッセージを削除しません。 代わりに、メッセージは検疫されます。 検疫済みメッセージの取得の詳細については、「[管理者として検疫済みメッセージを検索して解放する](find-and-release-quarantined-messages-as-an-administrator.md)」を参照してください。

マルウェア フィルター ポリシーを作成するには、次の構文を使用します。

```PowerShell
New-MalwareFilterPolicy -Name "<PolicyName>" [-Action <DeleteMessage | DeleteAttachmentAndUseDefaultAlert | DeleteAttachmentAndUseCustomAlert>] [-AdminDisplayName "<OptionalComments>"] [-CustomNotifications <$true | $false>] [<Inbound notification options>] [<Outbound notification options>]
```

この例では、次に示す設定で Contoso Malware Filter Policy という新しいマルウェア フィルター ポリシーを作成します。

- 受信者に通知せずにマルウェアを含むメッセージを検疫します ( _Action_パラメーターは使用し`DeleteMessage`ません。既定値はです)。

- メッセージ内でマルウェアが検出されたときにメッセージの送信者に通知しません ( _EnableExternalSenderNotifications_パラメーターまたは_EnableInternalSenderNotifications_パラメーターを`$false`使用していないため、両方の既定値があります)。

- 内部送信者からのメッセージでマルウェアが検出された場合は、管理者 admin@contoso.com に通知する。

```PowerShell
New-MalwareFilterPolicy -Name "Contoso Malware Filter Policy" -EnableInternalSenderAdminNotifications $true -InternalSenderAdminAddress admin@contoso.com
```

構文とパラメーターの詳細については、「[New-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/antispam-antimalware/new-malwarefilterpolicy)」を参照してください。

#### <a name="step-2-use-powershell-to-create-a-malware-filter-rule"></a>手順 2: PowerShell を使用してマルウェアフィルタールールを作成する

マルウェア フィルター ルールを作成するには、次の構文を使用します。

```PowerShell
New-MalwareFilterRule -Name "<RuleName>" -MalwareFilterPolicy "<PolicyName>" <Recipient filters> [<Recipient filter exceptions>] [-Comments "<OptionalComments>"]
```

この例では、次に示す設定で Contoso Recipients という新しいマルウェア フィルター ルールを作成します。

- Contoso Malware Filter Policy というマルウェア フィルター ポリシーにルールを割り当てる。

- contoso.com ドメイン内の受信者にルールを適用する。

```PowerShell
New-MalwareFilterRule -Name "Contoso Recipients" -MalwareFilterPolicy "Contoso Malware Filter Policy" -RecipientDomainIs contoso.com
```

構文とパラメーターの詳細については、「[New-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/antispam-antimalware/new-malwarefilterrule)」を参照してください。

### <a name="use-powershell-to-view-malware-filter-policies"></a>PowerShell を使用してマルウェアフィルターポリシーを表示する

すべてのマルウェア フィルター ポリシーの要約リストを返すには、次のコマンドを実行します。

```PowerShell
Get-MalwareFilterPolicy
```

特定のマルウェア フィルター ポリシーに関する詳細情報を返すには、次の構文を使用します。

```PowerShell
Get-MalwareFilterPolicy -Identity "<PolicyName>" | Format-List [<Specific properties to view>]
```

この例では、Executives というマルウェア フィルター ポリシーにルールのすべてのプロパティの値を戻します。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List
```

この例では、同じポリシーの指定したプロパティのみを戻します。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List Action,AdminDisplayName,CustomNotifications,Enable*Notifications
```

構文とパラメーターの詳細については、「[Get-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/antispam-antimalware/get-malwarefilterpolicy)」を参照してください。

### <a name="use-powershell-to-view-malware-filter-rules"></a>PowerShell を使用してマルウェアフィルタールールを表示する

すべてのマルウェア フィルター ルールの要約リストを返すには、次のコマンドを実行します。

```PowerShell
Get-MalwareFilterRule
```

特定のマルウェア フィルター ルールの詳細情報を返すには、次の構文を使用します。

```PowerShell
Get-MalwareFilterRule -Identity "<RuleName>" | Format-List [<Specific properties to view>]
```

この例では、Executives というマルウェア フィルター ルールのすべてのプロパティの値を返します。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List
```

この例では、同じルールの指定されたプロパティのみを返します。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List Name,Priority,State,MalwareFilterPolicy,*Is,*SentTo,*MemberOf
```

構文とパラメーターの詳細については、「[Get-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/antispam-antimalware/get-malwarefilterrule)」を参照してください。

### <a name="use-powershell-to-modify-malware-filter-policies"></a>PowerShell を使用してマルウェアフィルターポリシーを変更する

PowerShell でマルウェアフィルターポリシーを変更する場合に使用できる唯一の追加設定は、ポリシーを既定のポリシーに変更する_makedefault_スイッチです (すべてのユーザーに適用され、優先度は**低く**、削除することはできません)。

それ以外の場合は、PowerShell でマルウェアフィルターポリシーを変更しても、追加の設定は使用できません。 このトピックで前述した「[手順 1: PowerShell を使用してマルウェアフィルターポリシーを作成する](#step-1-use-powershell-to-create-a-malware-filter-policy)」に記載されているように、ポリシーを作成する場合にも同じ設定を使用できます。 Default という名前の既定のポリシーの名前は変更できないことに注意してください。

マルウェア フィルター ポリシー

```PowerShell
Set-MalwareFilterPolicy -Identity "<PolicyName>" <Settings>
```

構文とパラメーターの詳細については、「[Set-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/antispam-antimalware/set-malwarefilterpolicy)」を参照してください。

### <a name="use-powershell-to-modify-malware-filter-rules"></a>PowerShell を使用してマルウェアフィルタールールを変更する

PowerShell でマルウェアフィルタールールを変更するときには使用できない唯一の設定は、無効にされたルールを作成できる_有効_なパラメーターです。 既存のマルウェアフィルタールールを有効または無効にするには、次のセクションを参照してください。

それ以外の場合は、PowerShell でマルウェアフィルタールールを変更しても、追加の設定は使用できません。 このトピックで前述した「[手順 2: PowerShell を使用してマルウェアフィルタールールを作成する](#step-2-use-powershell-to-create-a-malware-filter-rule)」で説明されているように、ルールを作成する場合にも同じ設定を使用できます。

マルウェア フィルター ルールを変更するには、次の構文を使用します。

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" <Settings>
```

構文とパラメーターの詳細については、「[Set-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/antispam-antimalware/set-malwarefilterrule)」を参照してください。

### <a name="use-powershell-to-enable-or-disable-malware-filter-rules"></a>PowerShell を使用してマルウェアフィルタールールを有効または無効にする

PowerShell でマルウェアフィルタールールを有効または無効にすると、マルウェア対策ポリシー全体 (マルウェアフィルターポリシーおよび対応するマルウェアフィルタールール) の適用が有効または無効になります。

PowerShell でマルウェアフィルタールールを有効または無効にするには、次の構文を使用します。

```PowerShell
<Enable-MalwareFilterRule | Disable-MalwareFilterRule> -Identity "<RuleName>"
```

この例では、Marketing Department というマルウェア フィルター ルールを無効化します。

```PowerShell
Disable-MalwareFilterRule -Identity "Marketing Department"
```

この例では、同じルールを有効化します。

```PowerShell
Enable-MalwareFilterRule -Identity "Marketing"
```

詳細な構文およびパラメーターの情報については、[Enable-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/antispam-antimalware/enable-malwarefilterrule) と [Disable-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/antispam-antimalware/disable-malwarefilterrule).を参照してください。

### <a name="use-powershell-to-set-the-priority-of-malware-filter-rules"></a>PowerShell を使用してマルウェアフィルタールールの優先度を設定する

ルールに設定できる優先度の最高値値は 0 です。 設定できる最低値はルールの数に依存します。 たとえば、ルールが五つある場合、使用できる優先度の値は 0 から 4 です。 既存の一つのルールの優先度を変更すると、他のルールにも連鎖的な影響が起こりえます。 たとえば、5つのカスタムルール (優先度 0 ~ 4) があり、ルールの優先度を2に変更した場合、優先度2の既存のルールは優先度3に変更され、優先度3のルールは優先度4に変更されます。

PowerShell でマルウェアフィルタールールの優先度を設定するには、次の構文を使用します。

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" -Priority <Number>
```

この例では、Marketing Department というルールの優先度を 2 に設定しています。優先度が 2 以下のすべての既存のルールは、優先度が 1 ずつ下がります (優先度番号が 1 ずつ増加します)。

```PowerShell
Set-MalwareFilterRule -Identity "Marketing Department" -Priority 2
```

**注**:

- 新しいルールの作成時に優先度を設定するには、代わりに**new-malwarefilterrule**コマンドレットで_priority_パラメーターを使用します。

- Default という名前の既定のマルウェア対策ポリシーは、対応するマルウェアフィルタールールのないマルウェアフィルターポリシーです。また、未設定の優先度の値が**最低**になっています。

### <a name="use-powershell-to-remove-malware-filter-policies"></a>PowerShell を使用してマルウェアフィルターポリシーを削除する

PowerShell を使用してマルウェアフィルターポリシーを削除しても、対応するマルウェアフィルタールールは削除されません。

PowerShell でマルウェアフィルターポリシーを削除するには、次の構文を使用します。

```PowerShell
Remove-MalwareFilterPolicy -Identity "<PolicyName>"
```

この例では、Marketing Department というマルウェア フィルター ポリシーを削除します。

```PowerShell
Remove-MalwareFilterPolicy -Identity "Marketing Department"
```

構文とパラメーターの詳細については、「[Remove-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/antispam-antimalware/remove-malwarefilterpolicy)」を参照してください。

### <a name="use-powershell-to-remove-malware-filter-rules"></a>PowerShell を使用してマルウェアフィルタールールを削除する

PowerShell を使用してマルウェアフィルタールールを削除しても、対応するマルウェアフィルターポリシーは削除されません。

PowerShell でマルウェアフィルタールールを削除するには、次の構文を使用します。

```PowerShell
Remove-MalwareFilterRule -Identity "<PolicyName>"
```

この例では、Marketing Department という名前のマルウェアフィルタールールを削除します。

```PowerShell
Remove-MalwareFilterRule -Identity "Marketing Department"
```

構文とパラメーターの詳細については、「[Remove-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/antispam-antimalware/remove-malwarefilterrule)」を参照してください。

## <a name="how-do-you-know-these-procedures-worked"></a>これらの手順が正常に動作していることを確認する方法

### <a name="use-the-eicartxt-file-to-verify-your-anti-malware-policy-settings"></a>EICAR を使用します。テキストファイルを使用してマルウェア対策ポリシーの設定を確認する

> [!IMPORTANT]
> EICAR.TXT ファイルはウイルスでありません。 欧州大学のコンピューターのウイルス対策研究 (EICAR) は、ウイルス対策のインストールと設定を安全にテストするためにこのファイルを開発しました。

1. メモ帳を開き、次のテキストを空のファイルに貼り付けます。

   ```Text
   X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
   ```

   ファイル内のテキスト文字だけであることを確認してください。 ファイルサイズは68バイトである必要があります。

2. ファイルを EICAR として保存します。LICENSE.TXT

   デスクトップウイルス対策プログラムで、EICAR を除外するようにしてください。TXT をスキャンから読み取ります (それ以外の場合は、ファイルは検疫されます)。

3. EICAR を含む電子メールメッセージを送信します。ファイルを自動的にブロックしない電子メールクライアントを使用して、TXT ファイルを添付ファイルとして添付します。 次のテストシナリオを決定するには、マルウェア対策ポリシー設定を使用します。

   - 内部メールボックスから内部の受信者への電子メール。

   - 内部メールボックスから外部の受信者への電子メール。

   - 外部メールボックスから内部の受信者への電子メール。

4. メッセージが検疫されたことを確認し、マルウェア対策ポリシー設定に基づいて、受信者と送信者の通知結果を確認します。 例:

   - 受信者には通知されません。また、受信者は、EICAR で元のメッセージを受信します。TXT 添付ファイルは、既定またはカスタマイズされたテキストを含む、**マルウェアの警告テキスト .txt**に置き換えられます。

   - 内部または外部の送信者には、既定またはカスタマイズされた通知メッセージで通知されます。

   - 指定した管理者の電子メールアドレスには、内部または外部のメッセージ送信者に対して通知が行われ、既定またはカスタマイズされた通知メッセージが表示されます。

5. EICAR を削除します。TXT ファイルをテストした後 (他のユーザーが不必要に対ししていない場合)。
