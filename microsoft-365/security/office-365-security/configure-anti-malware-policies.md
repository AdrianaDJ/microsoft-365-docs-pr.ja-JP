---
title: マルウェア対策ポリシーを構成する
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: b0cfc21f-e3c6-41b6-8670-feb2b2e252e5
ms.collection:
- M365-security-compliance
description: 管理者は、Exchange Online Protection (EOP) でマルウェア対策ポリシーの表示、作成、変更、削除を行う方法を説明します。
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 032a63d61855c8698f441f14af9fd9bf75ead6d0
ms.sourcegitcommit: e12fa502bc216f6083ef5666f693a04bb727d4df
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/20/2020
ms.locfileid: "46825763"
---
# <a name="configure-anti-malware-policies-in-eop"></a>EOP でマルウェア対策ポリシーを構成する

Exchange Online にメールボックスを含む Microsoft 365 組織や、Exchange Online メールボックスを使用しないスタンドアロン Exchange Online Protection (EOP) 組織では、電子メール メッセージは EOP によってマルウェアから自動的に保護されます。 EOP はマルウェア対策ポリシーをマルウェア対策設定に使用します。 詳細については、「マルウェア対策 [保護」を参照してください](anti-malware-protection.md)。

管理者は、既定のマルウェア対策ポリシーを表示、編集、構成 (ただし削除) して、組織のニーズに合うことができます。 よりきめ細かく計画する場合は、組織内の特定のユーザー、グループ、またはドメインに適用するカスタムのマルウェア対策ポリシーを作成することもできます。 カスタム ポリシーは既定のポリシーより常に優先されますが、カスタム ポリシーの優先度 (実行順序) を変更できます。

マルウェア対策ポリシーの構成は、セキュリティ & コンプライアンス センターまたは PowerShell (Exchange Online 内にメールボックスを持つ Microsoft 365 組織、Exchange Online メールボックスを持つ組織向けのスタンドアロン EOP PowerShell) で行うことができます。

## <a name="what-do-you-need-to-know-before-you-begin"></a>はじめに把握しておくべき情報

- <https://protection.office.com/> でセキュリティ/コンプライアンス センターを開きます。 マルウェア対策のページに **直接移動するには、** 以下を使用します <https://protection.office.com/antimalware> 。

- Exchange Online PowerShell へ接続するには、「[Exchange Online PowerShell に接続する](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell)」を参照してください。 スタンドアロンの EOP PowerShell に接続するには、「[Exchange Online Protection PowerShell への接続](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-protection-powershell)」を参照してください。

- このトピックの手順を実行する際には、あらかじめアクセス許可を割り当てる必要があります。

  - マルウェア対策ポリシーを追加、変更、削除するには、次の役割グループのいずれかのメンバーである必要があります。

    - **組織の管理**または[セキュリティ/コンプライアンス センター](permissions-in-the-security-and-compliance-center.md)の**セキュリティ管理者**。
    - **組織の管理**または [Exchange Online](https://docs.microsoft.com/Exchange/permissions-exo/permissions-exo#role-groups) の**検疫管理**。

  - マルウェア対策ポリシーに読み取り専用アクセスするには、次の役割グループのいずれかのメンバーである必要があります。

    - [セキュリティ/コンプライアンス センター](permissions-in-the-security-and-compliance-center.md)の**セキュリティ閲覧者**。
    - [Exchange Online](https://docs.microsoft.com/Exchange/permissions-exo/permissions-exo#role-groups) の**表示限定の組織管理**。

- マルウェア対策ポリシーに推奨される設定については、EOP のマルウェア [対策ポリシーの設定を参照してください](recommended-settings-for-eop-and-office365-atp.md#eop-anti-malware-policy-settings)。

## <a name="use-the-security--compliance-center-to-create-anti-malware-policies"></a>セキュリティ コンプライアンス センターを&してマルウェア対策ポリシーを作成する

セキュリティ & コンプライアンス センターでカスタムのマルウェア対策ポリシーを作成すると、マルウェア フィルター ルールと、関連付けられているマルウェア フィルター ポリシーが両方に同じ名前で同時に作成されます。

1. セキュリティ/コンプライアンス センター&[マルウェア対策] に **移動** \> **し** \> **、[新しい**追加] **アイコン** ![ をクリックします ](../../media/ITPro-EAC-AddIcon.png) 。

2. 開いた **[マルウェア対策ポリシーの新規作成** ] ページで、以下の設定を構成します。

   - **[名前]**: わかりやすい一意のポリシー名を入力します。

   - **[説明]**: ポリシーについての説明を入力します (オプション)。

   - **Malware detection response :** Select one of these values for the **Do you want to notify recipients if their messages are quarantined?**

     - **い**いえ:メッセージは、意図した受信者に通知されなく検疫されます。 これは既定の値です。

     - **はい、既定の通知テキストを使用**します。メッセージは検疫されます。 メッセージのコピーが受信者に配信されますが、 *すべての* 添付ファイル (検出されたファイルも含む) は、既定のテキストを含む Malware Alert Text.txtという名前の **テキスト ファイルで ** 置き換えられます。 既定のテキストについては、「マルウェア対策 [ポリシー」を参照してください](anti-malware-protection.md#anti-malware-policies)。

     - **はい、次のカスタム通知テキストを使用**します。メッセージは検疫されます。 メッセージのコピーが受信者に配信されますが、 *すべての* 添付ファイル (検出されたファイルも含む) は **、「Malware Alert Text.txt」 ** という名前のテキスト ファイルで置き換えられて、カスタム警告テキスト ボックスで指定したカスタム **テキストが使用** されます。

   - **[添付ファイルの種類フィルター**]: コンピューターに問題を発生する **可能性がある添付ファイルの種類をブロックするには、これらの値のいずれかを選けます**。

     - **オフ**

     - **On:** 指定した添付ファイルを持つメッセージはマルウェアの検出として処理され、自動的に検疫されます。 [追加と削除] ボタンをクリックして一**覧の****削除を**変更できます。

   - **Malware Zero-hour Auto Purge**: マルウェア ZAP による検疫メッセージが既に配信されたことを示します。 詳細については [、Exchange Online のゼロアハージ (ZAP) を参照してください](zero-hour-auto-purge.md)。 次のいずれかの値を選します。

     - **オフ**

     - **オン (推奨)**

   - **通知**: このセクションの設定では、メッセージ内でマルウェアが検出された場合に、送信者と管理者の通知を制御します。

     - **Sender Notifications:** 次のオプションのどちらか、または両方を選択します。

       - **内部送信者に通知**: 内部送信者が組織内にいています。

       - **外部送信者に通知**: 外部送信者は組織の外側に存在しています。

     - **管理者の通知**: 次のオプションのどちらか、または両方を選択します。

       - **内部送信者からの配信されないメッセージを管理者に通知**: このオプションを選択した場合は、[管理者の電子メール アドレス] ボックスに通知の電子 **メール アドレスを入力** します。

       - **外部送信者からの配信されないメッセージを管理者に通知**: このオプションを選択した場合は、[管理者の電子メール アドレス] **ボックスに通知の電子メール アドレスを入力** します。

     - **通知の**カスタマイズ: これらの設定は、送信者または管理者に使用されている既定の通知テキストに置き換えることができます。 既定値の詳細については、「マルウェア対策ポリシー [」を参照してください](anti-malware-protection.md#anti-malware-policies)。

       - **カスタマイズされた通知テキスト**を使用する: このオプションを選択する場合、[ **差** 出人名] ボックスと [差出人 **] アドレス** ボックスを使用して、カスタマイズした通知メッセージに使用する送信者の名前と電子メール アドレスを指定する必要があります。

       - **内部送信者からのメッセージ**: 内部送信者からの配信不可能なメッセージについて送信者または管理者に通知する場合は、[件名] および [メッセージ]**Subject****ボックス**を使用して、カスタム通知メッセージの件名とメッセージ本文を指定する必要があります。

       - **外部送信者からのメッセージ**: 外部送信者からの配信不可能なメッセージについて送信者または管理者に通知する場合は、[件名] および [メッセージ]**Subject****ボックス**を使用して、カスタム通知メッセージの件名とメッセージ本文を指定する必要があります。

   - **適用対象**: このセクションの設定は、ポリシーが適用される内部受信者を識別します。

     - **1**つだけ選択し **、** ルールの条件を選択します。

       - **受信者は次の場所**に、組織内の 1 つ以上のメールボックス、メール ユーザー、またはメール連絡先を指定します。 表示される **[メンバーの選択**] ダイアログ ボックスで、リストから 1 人以上の受信者を選択し、[**追加 - ] をクリックします \> **。 [名前 **の確認** ] ボックスでは、ワイルドカードを使うかを指定できます (例: \* @fabrikam.com)。 完了したら、 **[OK]** をクリックします。

       - **受信者のドメインが**: 組織で構成されている 1 つ以上の承認済みドメイン内の受信者を指定します。 表示されるダイアログ ボックスで、1 つまたは複数のドメインを選択して **、[Add \> - ] をクリックします**。 完了したら、 **[OK]** をクリックします。

       - **受信者が次のメンバーの場合**: 組織内の 1 つまたは複数のグループを指定します。 [メンバー**の選択]** ダイアログ ボックスが表示されたら、リストから 1 つ以上のグループを選択し、[追加 - ]**をクリックします \> **。 完了したら、 **[OK]** をクリックします。

     一度に使用できる条件は 1 つのみですが、条件には複数の値を指定できます。 同じ条件に複数の値がある場合、OR ロジック (例、 _\<recipient1\>_ など) が使用されます _\<recipient2\>_ 。 さまざまな条件では AND ロジック (およびなど) が _\<recipient1\>_ 使います _\<member of group 1\>_ 。 さらに条件を追加するには、**[条件の追加]** をクリックして、リストから残りのオプションを選択します。

     - **Except if if:** To add exceptions for the rule, **click**on the **Select one** drop-down, and configure the exceptions. 設定と動作は、条件とまったく同じです。

3. 完了したら、**[保存]** をクリックします。

## <a name="use-the-security--compliance-center-to-view-anti-malware-policies"></a>セキュリティ コンプライアンス センターを&使用してマルウェア対策ポリシーを表示する

1. セキュリティ マネージャーとコンプライアンス &、[脅威管理**ポリシー マルウェア対策** \> **Policy** \> **] に移動します**。

2. ポリシーを選択すると、そのポリシーに関する情報が詳細ウィンドウに表示されます。 ポリシーの詳細を表示するには、[編集] **アイコンを** ![ クリックします ](../../media/ITPro-EAC-EditIcon.png) 。

   - **[有効]** プロパティの値、**[優先度]** プロパティの値、および **[適用先]** タブの設定が、マルウェア フィルター ルールに含まれます。

   - **[全般]** タブと **[設定]** タブの設定が、マルウェア フィルター ポリシーに含まれます。

## <a name="use-the-security--compliance-center-to-modify-anti-malware-policies"></a>セキュリティ コンプライアンス センター&使用してマルウェア対策ポリシーを変更する

1. セキュリティ マネージャーとコンプライアンス &、[脅威管理**ポリシー マルウェア対策** \> **Policy** \> **] に移動します**。

2. ポリシーを選択し、[編集] **アイコンを** ![ クリックします ](../../media/ITPro-EAC-EditIcon.png) 。 設定の詳細については、このトピックの「 [セキュリティ/コンプライアンス センター&使用してマルウェア対策ポリシーを](#use-the-security--compliance-center-to-create-anti-malware-policies) 作成する」セクションを参照してください。

   **注**:

   - 設定は、すべてが 1 つのページに配置されているのではなく、**[全般]** タブ、**[設定]** タブ、および **[適用先]** タブに分けられています。 [ **適用対象]** タブは、Default という名前の既定のポリシーでは使用できません (このポリシーは、自動的にすべてのユーザーに適用されます)。

   - 既定のポリシーの名前は変更できません。

## <a name="use-the-security--compliance-center-to-enable-or-disable-anti-malware-policies"></a>セキュリティ セキュリティ センター を&使用してマルウェア対策ポリシーを有効化または無効化する

1. セキュリティ マネージャーとコンプライアンス &、[脅威管理**ポリシー マルウェア対策** \> **Policy** \> **] に移動します**。

2. リストからポリシーを選択して、次に示すいずれかの設定を構成します。

   - **ポリシーを無効にします**: 有効化列のチェック ボックスを **オフ** にします。 既定では、マルウェア対策ポリシーは、セキュリティ設定/コンプライアンス センターで作成した&有効になっています。

   - **ポリシーを有効にします**: 有効化済み列のチェック ボックス **をオン** にします。

## <a name="use-the-security--compliance-center-to-set-the-priority-of-custom-anti-malware-policies"></a>セキュリティ マネージャー/&使用して、カスタムのマルウェア対策ポリシーの優先度を設定する

既定では、マルウェア対策ポリシーには、ポリシーの作成順序に基づいた優先度が設定されます (新しいポリシーの優先度が古いポリシーよりも低くなります)。 優先度番号が小さいほど、ポリシーの優先度が高くなることを意味します (優先度の高いポリシーは、優先度の低いポリシーよりも前に処理されます)。 2つのポリシーが同じ優先順位を持つことはできません。最初のポリシーが適用されると、ポリシーの処理は停止します。

 **注**:

- コンプライアンス センター&ポリシーの優先度は、そのポリシーの作成後にのみ変更できます。 PowerShell では、マルウェア フィルター ルールの作成時に既定の優先度を上書きすることができます (この上書きが既存のルールの優先度に影響を与える可能性があります)。

- コンプライアンス センター &で、マルウェア対策ポリシーは表示順に処理されます (最初のポリシーの **優先度** が 0 に設定されています)。 Default という名前の既定のマルウェア対策ポリシーの優先度 **は、Lowest**です。このポリシーは変更できません。

ポリシーの優先度を変更するには、リスト内で上下に移動させます (セキュリティ/コンプライアンス センター内で直接、**優先順位**番号を変更することはできません)。

1. セキュリティ マネージャーとコンプライアンス &、[脅威管理**ポリシー マルウェア対策** \> **Policy** \> **] に移動します**。

2. ポリシーを選択し、上矢印 **アイコンまたは下**矢 ![ 印 ](../../media/ITPro-EAC-UpArrowIcon.png) **アイコンをクリック** ![ ](../../media/ITPro-EAC-DownArrowIcon.png) して、ルールを一覧内で上または下に移動します。

## <a name="use-the-security--compliance-center-to-remove-anti-malware-policies"></a>セキュリティ センター のセキュリティ &使用してマルウェア対策ポリシーを削除する

セキュリティ コンプライアンス センターを使用して &マルウェア対策ポリシーを削除すると、マルウェア フィルター規則と、対応するマルウェア フィルター ポリシーの両方が削除されます。

1. セキュリティ マネージャーとコンプライアンス &、[脅威管理**ポリシー マルウェア対策** \> **Policy** \> **] に移動します**。

2. 一覧から削除するマルウェア対策ポリシーを選択して、[削除] アイコン **をクリック** ![ します ](../../media/ITPro-EAC-DeleteIcon.png) 。

## <a name="use-exchange-online-powershell-or-standalone-eop-powershell-to-configure-anti-malware-policies"></a>Exchange Online PowerShell またはスタンドアロン EOP PowerShell を使用してマルウェア対策ポリシーを構成する

### <a name="use-powershell-to-create-anti-malware-policies"></a>PowerShell を使用してマルウェア対策ポリシーを作成する

PowerShell でマルウェア対策ポリシーを作成するには、2 つの手順から構成されるプロセスを実行します。

1. マルウェア フィルター ポリシーを作成する。

2. マルウェア フィルター ルールを作成する (ルールの適用先のマルウェア フィルター ポリシーを指定します)。

 **注**:

- 新しいマルウェア フィルター ルールを作成して、既存の関連付けされていないマルウェア フィルター ポリシーをそのフィルター ルールに割り当てたりすることができます。 マルウェア フィルター ルールは、複数のマルウェア フィルター ポリシーに関連付けられることができません。

- PowerShell の新しいマルウェア対策ポリシーには、ポリシーを作成するまでセキュリティ & コンプライアンス センターで使用できない 2 つの設定を構成できます。

  - 新しいポリシーを無効化された状態で作成_します_ `$false` **(New-MalwareFilterRule コマンドレットで有効** )。

  - New-MalwareFilterRule コマンドレットで作成_中にポリシー_の優先度を設定する ( _\<Number\>_ **優先度** )

- ポリシーをマルウェア フィルター規則に割り当てるまでは、PowerShell で &作成した新しいマルウェア フィルター ポリシーがセキュリティ コンプライアンス センターに表示されません。

#### <a name="step-1-use-powershell-to-create-a-malware-filter-policy"></a>手順 1: PowerShell を使用してマルウェア フィルター ポリシーを作成する

**注**: EOP では、 _アクション パラメーター_ の値 `DeleteMessage` `DeleteAttachmentAndUseDefaultAlert` を取り、 `DeleteAttachmentAndUseCustomAlert` メッセージを削除しない 代わりに、メッセージは検疫されます。 検疫済みメッセージの取得の詳細については [、EOP の管理者として検疫済みメッセージおよびファイルを管理する方法を参照してください](manage-quarantined-messages-and-files.md)。

マルウェア フィルター ポリシーを作成するには、次の構文を使用します。

```PowerShell
New-MalwareFilterPolicy -Name "<PolicyName>" [-Action <DeleteMessage | DeleteAttachmentAndUseDefaultAlert | DeleteAttachmentAndUseCustomAlert>] [-AdminDisplayName "<OptionalComments>"] [-CustomNotifications <$true | $false>] [<Inbound notification options>] [<Outbound notification options>]
```

この例では、次に示す設定で Contoso Malware Filter Policy という新しいマルウェア フィルター ポリシーを作成します。

- 受信者に通知せずにマルウェアを含むメッセージを検疫する _(Action_ パラメーターは使用していません。既定値 `DeleteMessage` )。

- メッセージにマルウェアが検出された場合は、メッセージ送信者に通知しない _(EnableExternalSenderNotifications_ パラメーターまたは _EnableInternalSenderNotifications_ パラメーターは使用していません。両方の既定値は、次の既定値です `$false` )。

- 内部送信者からのメッセージでマルウェアが検出された場合は、管理者 admin@contoso.com に通知する。

```PowerShell
New-MalwareFilterPolicy -Name "Contoso Malware Filter Policy" -EnableInternalSenderAdminNotifications $true -InternalSenderAdminAddress admin@contoso.com
```

構文とパラメーターの詳細については、「[New-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/new-malwarefilterpolicy)」を参照してください。

#### <a name="step-2-use-powershell-to-create-a-malware-filter-rule"></a>手順 2: PowerShell を使用してマルウェア フィルター ルールを作成する

マルウェア フィルター ルールを作成するには、次の構文を使用します。

```PowerShell
New-MalwareFilterRule -Name "<RuleName>" -MalwareFilterPolicy "<PolicyName>" <Recipient filters> [<Recipient filter exceptions>] [-Comments "<OptionalComments>"]
```

この例では、次に示す設定で Contoso Recipients という新しいマルウェア フィルター ルールを作成します。

- Contoso Malware Filter Policy というマルウェア フィルター ポリシーにルールを割り当てる。

- contoso.com ドメイン内の受信者にルールを適用する。

```PowerShell
New-MalwareFilterRule -Name "Contoso Recipients" -MalwareFilterPolicy "Contoso Malware Filter Policy" -RecipientDomainIs contoso.com
```

構文とパラメーターの詳細については、「[New-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/new-malwarefilterrule)」を参照してください。

### <a name="use-powershell-to-view-malware-filter-policies"></a>PowerShell を使用してマルウェア フィルター ポリシーを表示する

すべてのマルウェア フィルター ポリシーの要約リストを返すには、次のコマンドを実行します。

```PowerShell
Get-MalwareFilterPolicy
```

特定のマルウェア フィルター ポリシーに関する詳細情報を返すには、次の構文を使用します。

```PowerShell
Get-MalwareFilterPolicy -Identity "<PolicyName>" | Format-List [<Specific properties to view>]
```

この例では、Executives というマルウェア フィルター ポリシーにルールのすべてのプロパティの値を戻します。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List
```

この例では、同じポリシーの指定したプロパティのみを戻します。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List Action,AdminDisplayName,CustomNotifications,Enable*Notifications
```

構文とパラメーターの詳細については、「[Get-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/get-malwarefilterpolicy)」を参照してください。

### <a name="use-powershell-to-view-malware-filter-rules"></a>PowerShell を使用してマルウェア フィルター ルールを表示する

すべてのマルウェア フィルター ルールの要約リストを返すには、次のコマンドを実行します。

```PowerShell
Get-MalwareFilterRule
```

ルールを有効または無効にしてリストをフィルター処理するには、次のコマンドを実行します。

```PowerShell
Get-HostedContentFilterRule -State Disabled
```

```PowerShell
Get-HostedContentFilterRule -State Enabled
```

特定のマルウェア フィルター ルールの詳細情報を返すには、次の構文を使用します。

```PowerShell
Get-MalwareFilterRule -Identity "<RuleName>" | Format-List [<Specific properties to view>]
```

この例では、Executives というマルウェア フィルター ルールのすべてのプロパティの値を返します。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List
```

この例では、同じルールの指定されたプロパティのみを返します。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List Name,Priority,State,MalwareFilterPolicy,*Is,*SentTo,*MemberOf
```

構文とパラメーターの詳細については、「[Get-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/get-malwarefilterrule)」を参照してください。

### <a name="use-powershell-to-modify-malware-filter-policies"></a>PowerShell を使用してマルウェア フィルター ポリシーを変更する

以下の項目以外では、PowerShell でマルウェア フィルター ポリシーを変更するときにも、このトピックで前述した手順 [1 で説明](#step-1-use-powershell-to-create-a-malware-filter-policy) したように、ポリシーを作成するときに同じ設定を使用できます。

- 指定_したポリシー_を既定のポリシー (すべてのユーザーに適用、優先度が低い、削除できない) に変換**Lowest**する MakeDefault スイッチは、PowerShell でマルウェア フィルター ポリシーを変更するときにのみ使用できます。

- マルウェア フィルター ポリシーの名前は変更できません **(Set-MalwareFilterPolicy コマンドレット** には _Name_ パラメーターはありません)。 セキュリティ コンプライアンス センターでマルウェア対策ポリシーの名前を変更&ときには、マルウェア フィルター規則の名前のみを変更 _します_。

マルウェア フィルター ポリシー

```PowerShell
Set-MalwareFilterPolicy -Identity "<PolicyName>" <Settings>
```

構文とパラメーターの詳細については、「[Set-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/set-malwarefilterpolicy)」を参照してください。

### <a name="use-powershell-to-modify-malware-filter-rules"></a>PowerShell を使用してマルウェア フィルター ルールを変更する

PowerShell でマルウェア フィルター ルールを変更するときに使用できない設定は _、無効_ 化されたルールの作成を可能にする Enabled パラメーターのみです。 既存のマルウェア フィルター ルールを有効または無効にするには、次のセクションを参照してください。

それ以外の場合、PowerShell でマルウェア フィルター ルールを変更するときに利用可能な追加の設定は存在しない。 手順 [2: PowerShell](#step-2-use-powershell-to-create-a-malware-filter-rule) を使用して、既にマルウェア フィルター規則セクションを作成する場合と同じ設定を使用できます。

マルウェア フィルター ルールを変更するには、次の構文を使用します。

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" <Settings>
```

構文とパラメーターの詳細については、「[Set-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/set-malwarefilterrule)」を参照してください。

### <a name="use-powershell-to-enable-or-disable-malware-filter-rules"></a>PowerShell を使ってマルウェア フィルター ルールを有効化または無効化する

PowerShell でマルウェア フィルター ルールを有効または無効にすると、マルウェア対策ポリシー全体 (マルウェア フィルター ルールおよび割り当てられているマルウェア フィルター ポリシー) が有効または無効になります。 既定のマルウェア対策ポリシーを有効または無効にすることはできません (常にすべての受信者に適用されます)。

PowerShell でマルウェア フィルター ルールを有効化または無効化するには、次の構文を使用します。

```PowerShell
<Enable-MalwareFilterRule | Disable-MalwareFilterRule> -Identity "<RuleName>"
```

この例では、Marketing Department というマルウェア フィルター ルールを無効化します。

```PowerShell
Disable-MalwareFilterRule -Identity "Marketing Department"
```

この例では、同じルールを有効化します。

```PowerShell
Enable-MalwareFilterRule -Identity "Marketing Department"
```

詳細な構文およびパラメーターの情報については、[Enable-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/enable-malwarefilterrule) と [Disable-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/disable-malwarefilterrule).を参照してください。

### <a name="use-powershell-to-set-the-priority-of-malware-filter-rules"></a>PowerShell を使ってマルウェア フィルター ルールの優先度を設定する

ルールに設定できる優先度の最高値値は 0 です。 設定できる最低値はルールの数に依存します。 たとえば、ルールが五つある場合、使用できる優先度の値は 0 から 4 です。 既存の一つのルールの優先度を変更すると、他のルールにも連鎖的な影響が起こりえます。 たとえば、カスタム ルールが 5 つあって (優先度 0 から 4)、1 つのルールの優先度を 2 に変更した場合には、既存の優先度 2 のルールは優先度 3 に変更され、優先度 3 は優先度 4 に変更されます。

PowerShell でマルウェア フィルター ルールの優先度を設定するには、次の構文を使用します。

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" -Priority <Number>
```

この例では、Marketing Department というルールの優先度を 2 に設定しています。優先度が 2 以下のすべての既存のルールは、優先度が 1 ずつ下がります (優先度番号が 1 ずつ増加します)。

```PowerShell
Set-MalwareFilterRule -Identity "Marketing Department" -Priority 2
```

**注**:

- 新しく作成したルールの優先度を設定するには **、New-MalwareFilterRule**コマンドレットの_Priority_パラメーターを使用します。

- 既定のマルウェア フィルター ポリシーには、対応するマルウェア フィルター ルールがありません。常に、変更不可能な優先度の値 **Lowest が設定されます**。

### <a name="use-powershell-to-remove-malware-filter-policies"></a>PowerShell を使ってマルウェア フィルター ポリシーを削除する

PowerShell を使用してマルウェア フィルター ポリシーを削除した場合は、それに対応するマルウェア フィルター ルールは削除されません。

PowerShell でマルウェア フィルター ポリシーを削除するには、次の構文を使用します。

```PowerShell
Remove-MalwareFilterPolicy -Identity "<PolicyName>"
```

この例では、Marketing Department というマルウェア フィルター ポリシーを削除します。

```PowerShell
Remove-MalwareFilterPolicy -Identity "Marketing Department"
```

構文とパラメーターの詳細については、「[Remove-MalwareFilterPolicy](https://docs.microsoft.com/powershell/module/exchange/remove-malwarefilterpolicy)」を参照してください。

### <a name="use-powershell-to-remove-malware-filter-rules"></a>PowerShell を使ってマルウェア フィルター ルールを削除する

PowerShell を使用してマルウェア フィルター ルールを削除した場合は、それに対応するマルウェア フィルター ポリシーは削除されません。

PowerShell でマルウェア フィルター ルールを削除するには、次の構文を使用します。

```PowerShell
Remove-MalwareFilterRule -Identity "<PolicyName>"
```

この例では、Marketing Department というマルウェア フィルター ルールを削除します。

```PowerShell
Remove-MalwareFilterRule -Identity "Marketing Department"
```

構文とパラメーターの詳細については、「[Remove-MalwareFilterRule](https://docs.microsoft.com/powershell/module/exchange/remove-malwarefilterrule)」を参照してください。

## <a name="how-do-you-know-these-procedures-worked"></a>正常な動作を確認する方法

### <a name="use-the-eicartxt-file-to-verify-your-anti-malware-policy-settings"></a>ドメイン ファイルEICAR.TXT使用してマルウェア対策ポリシー設定を確認する

> [!IMPORTANT]
> EICAR.TXT ファイルはウイルスでありません。 EICAR 用の European Institute for Computer Antivirus Research (EICAR) はこのファイルを開発し、ウイルス対策のインストールと設定を安全にテストしました。

1. メモ帳を開き、空のファイルに次のテキストを貼り付けます。

   ```Text
   X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
   ```

   これらには、ファイル内のテキスト文字としてのみ使用してください。 ファイル サイズは 68 バイトである必要があります。

2. ファイルを名前付きでEICAR.TXT

   デスクトップ ウイルス対策プログラムでは、ファイルのスキャン対象EICAR.TXTに (そうしないと、ファイルが検疫されます) を選択します。

3. ファイルが添付ファイルとして含EICAR.TXTメッセージを添付ファイルとして含む電子メール メッセージを、自動的にブロックしない電子メール クライアントを使用して送信します。 マルウェア対策のポリシー設定を使用して、以下のシナリオをテストします。

   - 内部メールボックスから内部受信者への電子メール

   - 内部メールボックスから外部受信者への電子メール

   - 外部のメールボックスから内部受信者への電子メール

4. メッセージが検疫されたことを確認し、マルウェア対策ポリシー設定に基づいて受信者と送信者の通知結果を確認します。 たとえば、次のようにします。

   - 受信者が通知を受け付けないか、受信者が既定またはカスタマイズ テキストが含まれている EICAR.TXT 添付ファイルを EICAR.TXT 添付 **ファイル Text.txtで置き換え ** した元のメッセージを受信します。

   - 内部または外部の送信者は、既定またはカスタマイズした通知メッセージで通知されます。

   - 指定した管理者の電子メール アドレスは、既定またはカスタマイズした通知メッセージを使用して、内部または外部のメッセージ送信者に対して通知されます。

5. テストが完了したEICAR.TXT ファイルを削除します (他のユーザーには不必要に対するイベントが発生しません)。
