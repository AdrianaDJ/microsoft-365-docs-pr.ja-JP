---
title: メールフロールールを使用して、実行可能な添付ファイル付きのメッセージをブロックする
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
ms.assetid: c4fb4a86-b772-49d0-8773-e8ee897e175d
ms.custom:
- seo-marvel-apr2020
description: 管理者は、メールフロールール (トランスポートルール) を作成して、実行可能な添付ファイルを含むメッセージをブロックする方法を学習できます。
ms.openlocfilehash: e579b4ac6daf9a537f5210071c71089a7536ab4e
ms.sourcegitcommit: 73b2426001dc5a3f4b857366ef51e877db549098
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/09/2020
ms.locfileid: "44617376"
---
# <a name="use-mail-flow-rules-to-block-messages-with-executable-attachments-in-eop"></a><span data-ttu-id="e561a-103">メール フロー ルールを使用して EOP で実行可能な添付ファイルを含むメッセージをブロックする</span><span class="sxs-lookup"><span data-stu-id="e561a-103">Use mail flow rules to block messages with executable attachments in EOP</span></span>

<span data-ttu-id="e561a-104">Exchange online メールボックスを使用しない Exchange online またはスタンドアロンの Exchange Online Protection (EOP) 組織内のメールボックスを持つ Microsoft 365 組織では、EOP はマルウェア対策ポリシーを使用して、実行可能な添付ファイルを含むメッセージを含む有害なメッセージをブロックします。</span><span class="sxs-lookup"><span data-stu-id="e561a-104">In Microsoft 365 organizations with mailboxes in Exchange Online or standalone Exchange Online Protection (EOP) organizations without Exchange Online mailboxes, EOP uses anti-malware policies to block harmful messages, including messages with executable attachments.</span></span> <span data-ttu-id="e561a-105">詳細については、「 [EOP でのマルウェア対策保護](anti-malware-protection.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e561a-105">For more information, see [Anti-malware protection in EOP](anti-malware-protection.md).</span></span>

<span data-ttu-id="e561a-106">保護をさらに強化するには、このトピックで説明されているように、メールフロールール (トランスポートルールとも呼ばれる) を使用して、実行可能な添付ファイルが含まれているメッセージを特定してブロックすることができます。</span><span class="sxs-lookup"><span data-stu-id="e561a-106">To further enhance protection, you can use mail flow rules (also known as transport rules) to identify and block messages that contain executable attachments as described in this topic.</span></span>

<span data-ttu-id="e561a-107">たとえば、マルウェアの発生によっては、特定の時間が経過した後に、影響を受けるユーザーが添付ファイルの送信に戻ることができるように、会社がこのルールを時間制限に従って適用することができます。</span><span class="sxs-lookup"><span data-stu-id="e561a-107">For example, following a malware outbreak, a company could apply this rule with a time limit so that affected users can get back to sending attachments after a specified length of time.</span></span>

## <a name="what-do-you-need-to-know-before-you-begin"></a><span data-ttu-id="e561a-108">始める前に把握しておくべき情報</span><span class="sxs-lookup"><span data-stu-id="e561a-108">What do you need to know before you begin?</span></span>

- <span data-ttu-id="e561a-109">これらの手順を実行する前に、アクセス許可を割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="e561a-109">You need to be assigned permissions before you can do these procedures:</span></span>

  - <span data-ttu-id="e561a-110">Exchange Online の場合は、「 [Exchange online の機能のアクセス許可](https://docs.microsoft.com/Exchange/permissions-exo/feature-permissions)」の「メールフロー」エントリを参照してください。</span><span class="sxs-lookup"><span data-stu-id="e561a-110">In Exchange Online, see the "Mail flow" entry in [Feature Permissions in Exchange Online](https://docs.microsoft.com/Exchange/permissions-exo/feature-permissions).</span></span>
  
  - <span data-ttu-id="e561a-111">スタンドアロン EOP では、既定で、組織の管理、ComplianceManagement、およびレコードの管理役割に割り当てられているトランスポートルールの役割が必要です。</span><span class="sxs-lookup"><span data-stu-id="e561a-111">In standalone EOP, you need the Transport Rules role, which is assigned to the OrganizationManagement, ComplianceManagement, and RecordsManagement roles by default.</span></span> <span data-ttu-id="e561a-112">詳細については、「 [Permissions in STANDALONE EOP](feature-permissions-in-eop.md) 」を参照して、EAC を使用して、[役割グループのメンバーの一覧を変更](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups)します。</span><span class="sxs-lookup"><span data-stu-id="e561a-112">For more information, see [Permissions in standalone EOP](feature-permissions-in-eop.md) and [Use the EAC modify the list of members in role groups](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups).</span></span>

- <span data-ttu-id="e561a-113">Exchange Online で EAC を開くには、「exchange [online の exchange 管理センター](https://docs.microsoft.com/Exchange/exchange-admin-center)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e561a-113">To open the EAC in Exchange Online, see [Exchange admin center in Exchange Online](https://docs.microsoft.com/Exchange/exchange-admin-center).</span></span> <span data-ttu-id="e561a-114">スタンドアロン EOP で EAC を開くには、「 [Exchange admin center in STANDALONE EOP](exchange-admin-center-in-exchange-online-protection-eop.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e561a-114">To open the EAC in standalone EOP, see [Exchange admin center in standalone EOP](exchange-admin-center-in-exchange-online-protection-eop.md).</span></span>

- <span data-ttu-id="e561a-115">Exchange Online PowerShell へ接続するには、「[Exchange Online PowerShell に接続する](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e561a-115">To connect to Exchange Online PowerShell, see [Connect to Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell).</span></span> <span data-ttu-id="e561a-116">スタンドアロンの EOP PowerShell に接続するには、「 [Exchange Online Protection の powershell への接続](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-protection-powershell)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e561a-116">To connect to standalone EOP PowerShell, see [Connect to Exchange Online Protection PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-protection-powershell).</span></span>

- <span data-ttu-id="e561a-117">Exchange Online およびスタンドアロン EOP のメールフロールールの詳細については、以下のトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="e561a-117">For more information about mail flow rules in Exchange Online and standalone EOP, see the following topics:</span></span>

  - [<span data-ttu-id="e561a-118">Exchange Online のメール フロー ルール (トランスポート ルール)</span><span class="sxs-lookup"><span data-stu-id="e561a-118">Mail flow rules (transport rules) in Exchange Online</span></span>](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rules)

  - [<span data-ttu-id="e561a-119">Exchange Online のメールフロールールの条件と例外 (述語)</span><span class="sxs-lookup"><span data-stu-id="e561a-119">Mail flow rule conditions and exceptions (predicates) in Exchange Online</span></span>](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)

  - [<span data-ttu-id="e561a-120">Exchange Online でのメール フロー ルールの処理</span><span class="sxs-lookup"><span data-stu-id="e561a-120">Mail flow rule actions in Exchange Online</span></span>](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)

## <a name="use-the-eac-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="e561a-121">EAC を使用して、実行可能な添付ファイル付きのメッセージをブロックするルールを作成する</span><span class="sxs-lookup"><span data-stu-id="e561a-121">Use the EAC to create a rule that blocks messages with executable attachments</span></span>

1. <span data-ttu-id="e561a-122">EAC で、 **[メール フロー]** \> **[ルール]** に移動します。</span><span class="sxs-lookup"><span data-stu-id="e561a-122">In the EAC, go to **Mail flow** \> **Rules**.</span></span>

2. <span data-ttu-id="e561a-123">[追加] アイコン**をクリックし**、[ ![ ](../../media/ITPro-EAC-AddIcon.png) **新しいルールの作成**] を選択します。</span><span class="sxs-lookup"><span data-stu-id="e561a-123">Click **Add** ![Add icon](../../media/ITPro-EAC-AddIcon.png) and then select **Create a new rule**.</span></span>

3. <span data-ttu-id="e561a-124">**[新しいルール]** のページが開いたら、以下の設定を行ってください:</span><span class="sxs-lookup"><span data-stu-id="e561a-124">In the **New rule** page that opens, configure the following settings:</span></span>

   - <span data-ttu-id="e561a-125">[**名前**]: わかりやすい一意のルールの名前を入力します。</span><span class="sxs-lookup"><span data-stu-id="e561a-125">**Name**: Enter a unique, descriptive name for the rule.</span></span>

   - <span data-ttu-id="e561a-126">[**その他のオプション**] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="e561a-126">Click **More Options**.</span></span>

   - <span data-ttu-id="e561a-127">[次の**場合、このルールを適用**する]:**すべての添付ファイル** \> **に実行可能なコンテンツがあり**ます。</span><span class="sxs-lookup"><span data-stu-id="e561a-127">**Apply this rule if**: Select **Any attachment** \> **has executable content**.</span></span>

   - <span data-ttu-id="e561a-128">**次の**操作を行います。 [**メッセージをブロック**する] を選択し、必要なアクションを選択します。</span><span class="sxs-lookup"><span data-stu-id="e561a-128">**Do the following**: Select **Block the message** and then choose the action you want:</span></span>

     - <span data-ttu-id="e561a-129">**メッセージを拒否して説明を含める**: 表示される [**拒否理由の指定**] ダイアログボックスで、配信不能レポート (NDR またはバウンスメッセージとも呼ばれる) に表示するテキストを入力します。</span><span class="sxs-lookup"><span data-stu-id="e561a-129">**reject the message and include an explanation**: In the **Specify reject reason** dialog that appears, enter the text you want to appear in the non-delivery report (also known as an NDR or bounce message).</span></span> <span data-ttu-id="e561a-130">5.7.1 で使用される既定拡張状態コードです。</span><span class="sxs-lookup"><span data-stu-id="e561a-130">The default enhanced status code that's used is 5.7.1.</span></span>

     - <span data-ttu-id="e561a-131">次**の拡張**状態コードのメッセージを拒否します。表示される [**拡張状態コードの入力**] ダイアログボックスで、NDR に表示する拡張状態コードを入力します。</span><span class="sxs-lookup"><span data-stu-id="e561a-131">**reject the message with the enhanced status code of**:  In the **Enter enhanced status code** dialog that appears, enter the enhanced status code that you want to appear in the NDR.</span></span> <span data-ttu-id="e561a-132">有効な値は5.7.1 または5.7.900 から5.7.999 への値です。</span><span class="sxs-lookup"><span data-stu-id="e561a-132">Valid values are 5.7.1 or a value from 5.7.900 to 5.7.999.</span></span> <span data-ttu-id="e561a-133">既定の拒否テキストは次のとおりです。配信は承認されず、メッセージは拒否されます。</span><span class="sxs-lookup"><span data-stu-id="e561a-133">The default rejection text is: Delivery not authorized, message refused.</span></span>

     - <span data-ttu-id="e561a-134">**だれにも通知せずにメッセージを拒否する**</span><span class="sxs-lookup"><span data-stu-id="e561a-134">**reject the message without notifying anyone**</span></span>

4. <span data-ttu-id="e561a-135">完了したら、**[保存]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="e561a-135">When you're finished, click **Save**.</span></span> <span data-ttu-id="e561a-136">添付ファイルのブロック ルールが強制されるようにになりました。</span><span class="sxs-lookup"><span data-stu-id="e561a-136">Your attachment blocking rule is now in force.</span></span>

## <a name="use-powershell-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="e561a-137">PowerShell を使用して、実行可能な添付ファイルを含むメッセージをブロックするルールを作成する</span><span class="sxs-lookup"><span data-stu-id="e561a-137">Use PowerShell to create a rule that blocks messages with executable attachments</span></span>

<span data-ttu-id="e561a-138">実行可能な添付ファイルを含むメッセージをブロックするルールを作成するには、次の構文を使用します。</span><span class="sxs-lookup"><span data-stu-id="e561a-138">Use the following syntax to create a rule to blocks messages that contain executable attachments:</span></span>

```powershell
New-TransportRule -Name "<UniqueName>" -AttachmentHasExecutableContent $true [-RejectMessageEnhancedStatusCode <5.7.1 | 5.7.900 to 5.7.999>] [-RejectMessageReasonText "<Text>"] [-DeleteMessage $true]
```

<span data-ttu-id="e561a-139">**注**:</span><span class="sxs-lookup"><span data-stu-id="e561a-139">**Notes**:</span></span>

- <span data-ttu-id="e561a-140">_RejectMessageReasonText_パラメーターを指定せずに_RejectMessageEnhancedStatusCode_パラメーターを使用した場合、既定のテキストは [配信が承認されていません] というメッセージは拒否されます。</span><span class="sxs-lookup"><span data-stu-id="e561a-140">If you use the _RejectMessageEnhancedStatusCode_ parameter without the _RejectMessageReasonText_ parameter, the default text is: Delivery not authorized, message refused.</span></span>

- <span data-ttu-id="e561a-141">_RejectMessageEnhancedStatusCode_パラメーターを指定せずに_RejectMessageReasonText_パラメーターを使用すると、既定のコードは5.7.1 になります。</span><span class="sxs-lookup"><span data-stu-id="e561a-141">If you use the _RejectMessageReasonText_ parameter without the _RejectMessageEnhancedStatusCode_ parameter, the default code is 5.7.1.</span></span>

<span data-ttu-id="e561a-142">この例では、実行可能な添付ファイルを含むメッセージをサイレントに削除する、[実行可能な添付ファイルをブロックする」という新しいルールを作成します。</span><span class="sxs-lookup"><span data-stu-id="e561a-142">This example creates a new rule named Block Executable Attachments that silently deletes messages that contain executable attachments.</span></span>

```powershell
New-TransportRule -Name "Block Executable Attachments" -AttachmentHasExecutableContent $true -DeleteMessage $true
```

<span data-ttu-id="e561a-143">詳細な構文とパラメーターについては、「[New-TransportRule](https://docs.microsoft.com/powershell/module/exchange/new-transportrule)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e561a-143">For detailed syntax and parameter information, see [New-TransportRule](https://docs.microsoft.com/powershell/module/exchange/new-transportrule).</span></span>

## <a name="how-do-you-know-this-worked"></a><span data-ttu-id="e561a-144">正常な動作を確認する方法</span><span class="sxs-lookup"><span data-stu-id="e561a-144">How do you know this worked?</span></span>

<span data-ttu-id="e561a-145">実行可能な添付ファイルが含まれているメッセージをブロックするメールフロールールが正常に作成されたことを確認するには、次のいずれかの手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="e561a-145">To verify that you've successfully create a mail flow rule to block messages that contain executable attachments, do any of the following steps:</span></span>

- <span data-ttu-id="e561a-146">EAC で、[**メールフロー** \> **ルール**] に移動し \> 、 \> [**編集** ![ ] 編集アイコンをクリックして ](../../media/ITPro-EAC-EditIcon.png) 設定を確認します。</span><span class="sxs-lookup"><span data-stu-id="e561a-146">In the EAC, go to **Mail flow** \> **Rules** \> select the rule \> click **Edit** ![Edit icon](../../media/ITPro-EAC-EditIcon.png), and verify the settings.</span></span>

- <span data-ttu-id="e561a-147">PowerShell で、次のコマンドを実行して設定を確認します。</span><span class="sxs-lookup"><span data-stu-id="e561a-147">In PowerShell, run the following command to verify the settings:</span></span>

  ```powershell
  Get-TransportRule -Identity "<Rule Name>" | Format-List Name,AttachmentHasExecutableContent,RejectMessage*,DeleteMessage
  ```
