---
title: メール フロー ルールを使用して、実行可能な添付ファイルがあるメッセージをブロックする
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
ms.assetid: c4fb4a86-b772-49d0-8773-e8ee897e175d
ms.custom:
- seo-marvel-apr2020
description: 管理者は、メール フロー ルール (トランスポート ルール) を作成して実行可能な添付ファイルを含むメッセージをブロックする方法について学習できます。
ms.openlocfilehash: b78fd282e6b5a7f20d1dab830da296e4be4ac812
ms.sourcegitcommit: e12fa502bc216f6083ef5666f693a04bb727d4df
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/20/2020
ms.locfileid: "46827655"
---
# <a name="use-mail-flow-rules-to-block-messages-with-executable-attachments-in-eop"></a>メール フロー ルールを使用して EOP で実行可能な添付ファイルを含むメッセージをブロックする

Exchange Online にメールボックスがある Microsoft 365 組織や、Exchange Online のメールボックスを使用しないスタンドアロン Exchange Online Protection (EOP) 組織では、EOP はマルウェア対策ポリシーを使用して、実行可能な添付ファイルのあるメッセージを含む、問題のあるメッセージをブロックします。 詳細については [、EOP のマルウェア対策保護を参照してください](anti-malware-protection.md)。

保護をさらに強化するために、メール フロー ルール (トランスポート ルールとも呼ばれる) を使って、このトピックで説明されている実行可能な添付ファイルを含むメッセージを識別してブロックすることができます。

たとえば、マルウェアの感じた後、会社が時間制限付きでこのルールを適用すると、影響を受けるユーザーが指定した期間の後で添付ファイルを送信し戻すようになります。

## <a name="what-do-you-need-to-know-before-you-begin"></a>はじめに把握しておくべき情報

- これらの手順を実行する場合は、あかじにアクセス許可を割り当てる必要があります。

  - Exchange Online では、Exchange Online の機能アクセス許可の「メール [フロー」エントリを参照してください](https://docs.microsoft.com/Exchange/permissions-exo/feature-permissions)。
  
  - スタンドアロン EOP では、トランスポート ルールの役割が必要です。この役割は、既定で OrganizationManagement、ComplianceManagement、および RecordsManagement の役割に割り当てられます。 詳細については、「スタンドアロン [EOP のアクセス許可」を参照し、EAC](feature-permissions-in-eop.md) [を使用して役割グループ内のメンバーの一覧を変更します](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups)。

- Exchange Online の EAC を開くには、「Exchange Online [の Exchange 管理センター」を参照してください](https://docs.microsoft.com/Exchange/exchange-admin-center)。 スタンドアロン EOP の EAC を開くには、「スタンドアロン EOP [の Exchange 管理センター」を参照してください](exchange-admin-center-in-exchange-online-protection-eop.md)。

- Exchange Online PowerShell へ接続するには、「[Exchange Online PowerShell に接続する](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell)」を参照してください。 スタンドアロンの EOP PowerShell に接続するには、「[Exchange Online Protection PowerShell への接続](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-protection-powershell)」を参照してください。

- Exchange Online でのメール フロー ルールとスタンドアロン EOP のメール フロー ルールの詳細については、以下のトピックを参照してください。

  - [Exchange Online のメール フロー ルール (トランスポート ルール)](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rules)

  - [Exchange Online のメール フロー ルールでの条件と例外 (述語)](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)

  - [Exchange Online でのメール フロー ルールの処理](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)

## <a name="use-the-eac-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a>EAC を使用して、実行可能ファイルが添付されたメッセージをブロックするルールを作成する

1. EAC で、 **[メール フロー]** \> **[ルール]** に移動します。

2. [追加 **] アイコン** ![ をクリック ](../../media/ITPro-EAC-AddIcon.png) し、[新しい **ルールを作成する] を選択します**。

3. **[新しいルール]** のページが開いたら、以下の設定を行ってください:

   - **名前**: わかりやすい一意のルールの名前を入力します。

   - [**その他のオプション**] をクリックします。

   - **いずれかの添付ファイルに実行可能**なコンテンツ **がある場合** \> **にこのルールを適用します**。

   - **次の操作を****行います。メッセージをブロックして**、目的のアクションを選択します。

     - **メッセージを拒否し、説明を**含める: 表示 **される拒否理由** の指定ダイアログに、配信不能レポート (NDR またはバウンス メッセージとも呼ばれる) に表示するテキストを入力します。 5.7.1 で使用される既定拡張状態コードです。

     - **次のような拡張状態コードを含むメッセージを拒否**します。表示 **される拡張状態** コードの入力ダイアログで、NDR に表示する拡張状態コードを入力します。 有効な値は 5.7.1、または 5.7.900 から 5.7.999 の値です。 既定の拒否テキスト: 配信は承認されません。メッセージ拒否。

     - **[任意のユーザーに通知せずにメッセージを拒否する]**

4. 完了したら、**[保存]** をクリックします。 添付ファイルのブロック ルールが強制されるようにになりました。

## <a name="use-powershell-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a>PowerShell を使用して、実行可能ファイルが添付されたメッセージをブロックするルールを作成する

次の構文を使用して、実行可能な添付ファイルを含むメッセージをブロックするルールを作成します。

```powershell
New-TransportRule -Name "<UniqueName>" -AttachmentHasExecutableContent $true [-RejectMessageEnhancedStatusCode <5.7.1 | 5.7.900 to 5.7.999>] [-RejectMessageReasonText "<Text>"] [-DeleteMessage $true]
```

**注**:

- _RejectMessageReasonText パラメーターなしで RejectMessageEnhancedStatusCode_パラメーター_を使用_する場合、既定のテキストは次のテキストになります。配信は許可されません。メッセージ拒否。

- _RejectMessageEnhancedStatusCode パラメーターなしで_ _RejectMessageReasonText パラメーターを使用_する場合、既定のコードは 5.7.1 です。

この例では、Block Executable Attachments という名前の新しいルールを作成して、実行可能な添付ファイルを含むメッセージを確認確認しなけ取りを要求して削除します。

```powershell
New-TransportRule -Name "Block Executable Attachments" -AttachmentHasExecutableContent $true -DeleteMessage $true
```

詳細な構文とパラメーターについては、「[New-TransportRule](https://docs.microsoft.com/powershell/module/exchange/new-transportrule)」を参照してください。

## <a name="how-do-you-know-this-worked"></a>正常な動作を確認する方法

実行可能な添付ファイルを含むメッセージをブロックするメール フロー ルールが正常に作成されたことを確認するには、次のいずれかの手順を実行します。

- EAC で、[メール フロー ルール]**に移動し** \> **Rules** \> 、[編集] アイコン \> をクリック**Edit** ![ して ](../../media/ITPro-EAC-EditIcon.png) 設定を確認します。

- PowerShell で次のコマンドを実行して設定を確認します。

  ```powershell
  Get-TransportRule -Identity "<Rule Name>" | Format-List Name,AttachmentHasExecutableContent,RejectMessage*,DeleteMessage
  ```
